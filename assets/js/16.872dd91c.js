(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{414:function(e,r,s){"use strict";s.r(r);var t=s(56),n=Object(t.a)({},(function(){var e=this,r=e.$createElement,s=e._self._c||r;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"la-mise-en-ligne"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#la-mise-en-ligne"}},[e._v("#")]),e._v(" La mise en ligne")]),e._v(" "),s("h2",{attrs:{id:"personnaliser-les-pages-d-erreur"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#personnaliser-les-pages-d-erreur"}},[e._v("#")]),e._v(" Personnaliser les pages d'erreur")]),e._v(" "),s("p",[e._v("Avec Symfony, lorsqu'une exception est déclenchée, le noyau l'attrape. Cela lui permet ensuite d'effectuer l'action adéquate.")]),e._v(" "),s("p",[e._v("Le comportement par défaut du noyau consiste à appeler un contrôleur particulier intégré à Symfony : "),s("strong",[e._v("Symfony\\Component\\HttpKernel\\Controller\\ErrorController")]),e._v(". Ce contrôleur récupère les informations de l'exception, choisi le template adéquat (un template différent par type d'erreur : 404, 500, etc.), passe les informations au template et envoie la réponse générée.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Depuis Symfony 5, c'est le "),s("strong",[e._v("composant ErrorHandler")]),e._v(" qui est chargé de générer ces pages d'erreurs.")])]),e._v(" "),s("p",[e._v("Ces pages d'erreurs utilise Twig à travers son bundle pour être généré. Dans Symfony, il est possible de surcharger les templates fournit avec un bundle. Puisque "),s("strong",[e._v("TwigBundle")]),e._v(" est un bundle, on peut surcharger ses vues pour les adapter à nos besoins ! Il suffit donc de créer nos propres templates et de dire à Symfony d'utiliser nos templates et non ceux par défaut.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Les pages d'erreur de Symfony sont affichées lorsque le noyau attrape une exception. Il existe deux pages différentes : celle en mode "),s("strong",[e._v("dev")]),e._v(" et celle en mode "),s("strong",[e._v("prod")]),e._v(".")])]),e._v(" "),s("p",[e._v("Il est possible de personnaliser les deux, mais celle qui nous intéresse le plus ici est la page d'erreur en mode production. En effet, c'est celle qui sera affichée à nos visiteurs.")]),e._v(" "),s("p",[e._v("Voici à quoi ressemble la page d'erreur "),s("strong",[e._v("404")]),e._v(" standard :")]),e._v(" "),s("p",[s("img",{attrs:{src:"/img/404.png",alt:"Page 404 de base"}})]),e._v(" "),s("p",[e._v("Il est très simple de remplacer les vues d'un bundle quelconque par les nôtres. Il suffit de créer le répertoire "),s("strong",[e._v("/templates/bundles/NomDuBundle/")]),e._v(" et d'y placer nos vues à nous ! Et cela est valable quelque soit le bundle.")]),e._v(" "),s("p",[e._v("Dans notre cas, ce sera "),s("strong",[e._v("/templates/bundles/TwigBundle/Exception")]),e._v(". Et au sein de ce dossier, le bundle utilise la convention suivante pour chaque nom de template :")]),e._v(" "),s("ul",[s("li",[e._v("Il vérifie d'abord l'existence du template "),s("strong",[e._v("error[code_erreur].html.twig")]),e._v(", par exemple "),s("strong",[e._v("error404.html.twig")]),e._v(" dans le cas d'une page introuvable (erreur 404).")]),e._v(" "),s("li",[e._v("Si ce template n'existe pas, il utilise le template "),s("strong",[e._v("error.html.twig")]),e._v(", une sorte de page d'erreur générique.")])]),e._v(" "),s("p",[e._v("Je vous conseille de créer un "),s("strong",[e._v("error404.html.twig")]),e._v(" pour les pages non trouvées, en plus du "),s("strong",[e._v("error.html.twig")]),e._v(" générique. Cela vous permet d'afficher un petit texte sympa pour que l'utilisateur ne soit pas trop perdu.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Vous pouvez donc utiliser Twig pour générer vos pages d'erreur, ce qui signifie que vous pouvez par exemple étendre le layout (avec la barre de navigation, ...) dans celles-ci. Très pratique pour ne pas perdre nos visiteurs quand ils arrivent sur une page d'erreurs !")])]),e._v(" "),s("h2",{attrs:{id:"verifier-son-site-symfony"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#verifier-son-site-symfony"}},[e._v("#")]),e._v(" Vérifier son site Symfony")]),e._v(" "),s("h3",{attrs:{id:"tester-son-application"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tester-son-application"}},[e._v("#")]),e._v(" Tester son application")]),e._v(" "),s("p",[e._v("Bien évidemment, la première chose à faire avant d'envoyer son application sur un serveur, c'est de bien vérifier que tout fonctionne chez soi ! Vous êtes habitués à travailler dans l'environnement de développement et c'est normal, mais pour bien préparer le passage en production, il va falloir tester l'application dans l'environnement de production. Et pour ce faire il faut passer son application en mode production, dans le fichier "),s("strong",[e._v(".env")]),e._v(" adéquat, puis vider le cache.")]),e._v(" "),s("h3",{attrs:{id:"verifier-la-qualite-du-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#verifier-la-qualite-du-code"}},[e._v("#")]),e._v(" Vérifier la qualité du code")]),e._v(" "),s("p",[e._v("L'importance d'écrire un code de qualité n'est plus à démontrer. Symfony étant un framework très puissant, le code que vous faites se doit d'être à la hauteur, et il n'est pas évident de le passer entièrement en revue pour s'en assurer. Heureusement, il existe un outil qui permet de vérifier automatiquement un grand nombre de points particuliers dans votre code. Il s'agit d'un outil en ligne, "),s("a",{attrs:{href:"https://insight.symfony.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Symfony insight"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("Je vous invite à aller voir, à l'adresse précédente, les points que cet outil vérifie. Ils sont tous intéressants à prendre en compte si vous voulez avoir une application Symfony de grande qualité.")]),e._v(" "),s("p",[e._v("Vous pouvez utiliser gratuitement l'outil sur vos projets publics, c'est-à-dire que votre projet doit avoir un Git publiquement accessible")]),e._v(" "),s("h2",{attrs:{id:"deployer-son-site-symfony-en-ligne"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployer-son-site-symfony-en-ligne"}},[e._v("#")]),e._v(" Déployer son site Symfony en ligne")]),e._v(" "),s("p",[e._v("Votre application web est terminée et prête à être mise en production ! Avant de déployer votre projet sur un serveur, il y a plusieurs points auxquels il est nécessaire de porter une attention particulière lorsqu'il s'agit du framework Symfony.")]),e._v(" "),s("p",[e._v("Le déploiement d'une application est toujours une étape délicate qui touche au domaine de la configuration du serveur. En général, on se retrouve dans deux cas :")]),e._v(" "),s("ol",[s("li",[e._v("Soit vous n'avez pas accès en SSH à votre serveur (la plupart des hébergements mutualisés, etc.)")]),e._v(" "),s("li",[e._v("Soit vous avez accès en SSH à votre serveur (VPS, serveur dédiés, etc.)")])]),e._v(" "),s("p",[e._v("Voici une liste des étapes à effectuer dans les deux cas, avec des précisions si nécessaire. Je ne vais pas rentrer dans les détails de la configuration serveur. Pour ça, je vous renvoie à la "),s("a",{attrs:{href:"https://symfony.com/doc/current/setup/web_server_configuration.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentation de Symfony"),s("OutboundLink")],1),e._v(" sur le sujet.")]),e._v(" "),s("h3",{attrs:{id:"sans-acces-ssh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sans-acces-ssh"}},[e._v("#")]),e._v(" Sans accès SSH")]),e._v(" "),s("p",[e._v("En local :")]),e._v(" "),s("ol",[s("li",[s("RouterLink",{attrs:{to:"/cours/mise-en-ligne.html#dependances-de-developpement"}},[e._v("Vérifier les dépendances de développement")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cours/mise-en-ligne.html#composer-pour-la-production"}},[e._v("Mettre à jour les dépendances sans celles de développement et en optimisant l'autoload de "),s("strong",[e._v("Composer")])])],1)]),e._v(" "),s("p",[e._v("Sur le serveur :")]),e._v(" "),s("ol",[s("li",[s("RouterLink",{attrs:{to:"/cours/mise-en-ligne.html#envoi-de-fichier"}},[e._v("Envoyer les fichiers (via SFTP) sur le serveur sans le dossier "),s("strong",[e._v("/var/")]),e._v(" et le fichier "),s("strong",[e._v(".env.local")])])],1),e._v(" "),s("li",[e._v("Créer la base de données avec un script SQL (ex: export de la version local)")]),e._v(" "),s("li",[e._v("Recréer le fichier .env.local à partir du .env en adaptant les valeurs (environnement de production, connexion base de données, ...)")]),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cours/mise-en-ligne.html#reecrire-les-url"}},[e._v("Mettre en place un fichier .htaccess à la racine si nécessaire")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cours/mise-en-ligne.html#regler-les-droits-sur-le-dossier-var"}},[e._v("Vérifier les droits d'écriture de /var/")])],1)]),e._v(" "),s("h3",{attrs:{id:"avec-acces-ssh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#avec-acces-ssh"}},[e._v("#")]),e._v(" Avec accès SSH")]),e._v(" "),s("p",[e._v("En local :")]),e._v(" "),s("ol",[s("li",[s("RouterLink",{attrs:{to:"/cours/mise-en-ligne.html#dependances-de-developpement"}},[e._v("Vérifier les dépendances de développement")])],1)]),e._v(" "),s("p",[e._v("Sur le serveur :")]),e._v(" "),s("ol",[s("li",[s("RouterLink",{attrs:{to:"/cours/mise-en-ligne.html#envoie-de-fichier"}},[e._v("Envoyer les fichiers sur le serveur (par exemple avec Git) sans les dossiers "),s("strong",[e._v("/var/")]),e._v(" et "),s("strong",[e._v("/vendor/")]),e._v(" et le fichier "),s("strong",[e._v(".env.local")])])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cours/mise-en-ligne.html#composer-pour-la-production"}},[e._v("Mettre à jour les dépendances sans celles de développement et en optimisant l'autoload de "),s("strong",[e._v("Composer")])])],1),e._v(" "),s("li",[e._v("Configurer le serveur web (Apache, NGINX, ...) en pointant sur la partie public de votre projet (ex: /var/www/shoefony/public/)")]),e._v(" "),s("li",[e._v("Ajouter les variables d'environnements dans la configuration serveur (environnement de production, connexion base de données, ...)")]),e._v(" "),s("li",[e._v("Créer et/ou mettre à jour la base de données en ligne de commande")]),e._v(" "),s("li",[e._v("Exécuter la commande "),s("strong",[e._v("cache:clear")]),e._v(" et si erreur : "),s("RouterLink",{attrs:{to:"/cours/mise-en-ligne.html#regler-les-droits-sur-le-dossier-var"}},[e._v("Vérifier les droits d'écriture de /var/")])],1)]),e._v(" "),s("h3",{attrs:{id:"explications-en-details"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#explications-en-details"}},[e._v("#")]),e._v(" Explications en détails")]),e._v(" "),s("h4",{attrs:{id:"dependances-de-developpement"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dependances-de-developpement"}},[e._v("#")]),e._v(" Dépendances de développement")]),e._v(" "),s("p",[e._v("Lorsque nous développons notre application, nous avons des outils comme la "),s("strong",[e._v("DebugBar")]),e._v(", le "),s("strong",[e._v("MakerBundle")]),e._v(", etc. Ce sont ce qu'on appelle des dépendances de développement. Ces dépendances doivent se trouver dans la partie "),s("strong",[e._v("require-dev")]),e._v(" de notre fichier "),s("strong",[e._v("composer.json")]),e._v(". Avant de mettre en production un projet, il est nécessaire de vérifier que les dépendances de développement et de production soit bien séparées.")]),e._v(" "),s("p",[e._v("Lorsque nous avons accès à la configuration de notre serveur web de production, nous pouvons déplacer deux dépendances de plus dans le require-dev :")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("symfony/apache-pack")]),e._v(" : Cette dépendance est utile uniquement avec Flex pour créer un fichier "),s("strong",[e._v(".htaccess")]),e._v(" dans le dossier "),s("strong",[e._v("/public/")]),e._v(". Il est possible de gérer ça directement dans la configuration serveur (ce qui est aussi plus performant).")]),e._v(" "),s("li",[s("strong",[e._v("symfony/dotenv")]),e._v(" : C'est ce composant qui est chargé de lire nos fichier "),s("strong",[e._v(".env")]),e._v(". En production, on peut mettre les variables d'environnement dans la configuration serveur (ce qui est également plus sûre).")])]),e._v(" "),s("h4",{attrs:{id:"composer-pour-la-production"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#composer-pour-la-production"}},[e._v("#")]),e._v(" Composer pour la production")]),e._v(" "),s("p",[e._v("En production, nous ne voulons pas des dépendances de développement de notre projet. Pour ne pas les installer, il suffit d'ajouter l'option "),s("strong",[e._v("--no-dev")]),e._v(" lorsque l'on exécute "),s("strong",[e._v("Composer")]),e._v(".")]),e._v(" "),s("p",[e._v("Nous pouvons également optimiser l'autoload fournit par Composer avec l'option "),s("strong",[e._v("--optimize-autoloader")]),e._v(" ou "),s("strong",[e._v("-o")]),e._v(" en raccourcie.")]),e._v(" "),s("p",[e._v("Ce qui nous donne :")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Mise à jour des dépendances sans celles de dev et en optimisant l'autoload")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("composer")]),e._v(" update --no-dev -o\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ou si on ne veut pas mettre à jour les dépendances")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("composer")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" --no-dev -o\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Pour seulement re-générer l'autoload en l'optimisant")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("composer")]),e._v(" dump-autoload -o\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("h4",{attrs:{id:"envoi-de-fichier"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#envoi-de-fichier"}},[e._v("#")]),e._v(" Envoi de fichier")]),e._v(" "),s("p",[e._v("Notre projet est plein de dossier et de fichiers, seulement, tout ne doit pas être envoyé sur le serveur ! Pour savoir quoi envoyer, vous pouvez consulter le fichier "),s("strong",[e._v("/.gitignore")]),e._v(" à la racine de votre projet.")]),e._v(" "),s("p",[e._v("De manière générale, on n'envoie pas le dossier "),s("strong",[e._v("/var/")]),e._v(" qui contient le cache et les logs de l'application. Il sera généré automatiquement par notre application.")]),e._v(" "),s("p",[e._v("Le dossier "),s("strong",[e._v("/vendor/")]),e._v(", qui contient les dépendances, ne doit être envoyé que si nous n'avons pas accès à Composer sur le serveur (toujours pas de SSH...). Comme le dossier var, il est très lourd !")]),e._v(" "),s("p",[e._v("Enfin, il ne faut pas envoyer le fichier "),s("strong",[e._v("/.env.local")]),e._v(" qui contient les variables d'environnements. En effet, elles dépendent de la machine sur laquelle l'application est exécutée. On envoie par contre le fichier "),s("strong",[e._v("/.env")]),e._v(" qui contient des données d'exemple pour nous aider à créer le premier cité.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Pour envoyer nos fichiers sans accès SSH, ce sera via "),s("strong",[e._v("FTP")]),e._v(". Dans le cas contraire, on a plusieurs options (dont le FTP d'ailleurs). Personnellement, j'utilise "),s("strong",[e._v("Git")]),e._v(" pour cette tâche.")])]),e._v(" "),s("h4",{attrs:{id:"reecrire-les-url"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reecrire-les-url"}},[e._v("#")]),e._v(" Réécrire les URL")]),e._v(" "),s("p",[e._v("Suivant la configuration de votre serveur vous risquez d'obtenir une URL du type : "),s("strong",[e._v("http://www.MON-DOMAINE.fr/public/")])]),e._v(" "),s("p",[e._v("Cette dernière n'est pas super, et permettrait à vos visiteurs d'accéder à des répertoires auxquels ils ne devraient jamais avoir à rencontrer. La sécurité avant tout !")]),e._v(" "),s("p",[e._v("Si votre serveur utilise Apache (il y a de très grandes chances), vous pouvez configurer votre espace web à l'aide d'un fichier .htaccess, à la racine de votre projet, en demandant à cibler directement votre répertoire public. Les instructions à ajouter dans ce fichier sont les suivantes :")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("<IfModule mod_rewrite.c>\n    RewriteEngine On\n    RewriteCond %{REQUEST_FILENAME} !-f\n    RewriteRule ^(.*)$ public/$1 [QSA,L]\n</IfModule>\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("h4",{attrs:{id:"regler-les-droits-sur-le-dossier-var"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#regler-les-droits-sur-le-dossier-var"}},[e._v("#")]),e._v(" Régler les droits sur le dossier var/")]),e._v(" "),s("p",[e._v("Vous le savez, Symfony a besoin de pouvoir écrire dans deux répertoires : "),s("strong",[e._v("/var/cache")]),e._v(" pour y mettre le cache de l'application et ainsi améliorer les performances, et "),s("strong",[e._v("/var/log")]),e._v(" pour y mettre l'historique des informations et erreurs rencontrées lors de l'exécution des pages.")]),e._v(" "),s("p",[e._v("Normalement, vous n'avez pas besoin de créer le dossier vous-même. Il se créera tout seul lors de l'exécution du code. Cependant, si vous avez une erreur, vous pouvez le créer manuellement, mettre les bons droits UNIX dessus (751 par exemple) et laisser Symfony le remplir.")]),e._v(" "),s("p",[e._v("Normalement, votre client FTP devrait vous permettre de régler les droits sur les dossiers. Avec "),s("strong",[e._v("FileZilla")]),e._v(" par exemple, un clic droit sur le dossier "),s("strong",[e._v("/var/")]),e._v(" vous permet de définir les droits.")]),e._v(" "),s("p",[e._v("En ligne de commande sur Linux, ça se fait de la manière suivante :")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("751")]),e._v(" -R ./var\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h2",{attrs:{id:"pour-aller-plus-loin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pour-aller-plus-loin"}},[e._v("#")]),e._v(" Pour aller plus loin")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://symfony.com/doc/current/controller/error_pages.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Documentation de Symfony sur la surcharge des templates d'erreurs"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://symfony.com/doc/current/deployment.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Documentation de Symfony sur le déploiement"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://symfony.com/doc/current/setup/web_server_configuration.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Documentation de Symfony sur la config serveur"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);r.default=n.exports}}]);