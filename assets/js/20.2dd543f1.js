(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{418:function(s,t,e){"use strict";e.r(t);var a=e(56),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"authentification-et-autorisations"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authentification-et-autorisations"}},[s._v("#")]),s._v(" Authentification et autorisations")]),s._v(" "),e("p",[s._v("Symfony propose un mécanisme très complet permettant de gérer l'"),e("strong",[s._v("authentification")]),s._v(" et les "),e("strong",[s._v("autorisations")]),s._v(". Dans ce chapitre, nous allons mettre en place une système d'authentification à l'aide d'un formulaire de connexion et évoquer les bases des autorisations.")]),s._v(" "),e("p",[s._v("Ces deux points cruciaux sont gérées ensemble à travers les packages de "),e("strong",[s._v("Security")]),s._v(", composées de plusieurs "),e("strong",[s._v("composants")]),s._v(" et d'un "),e("strong",[s._v("bundle")]),s._v(". Encore une fois, ce bundle permet l'"),e("strong",[s._v("intégration")]),s._v(" des composants dans le framework.")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Permet d'installer le bundle grâce à son alias de Symfony Flex")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v(" require security\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("Flex va également de nouveau nous créer un fichier de configuration pour ce bundle "),e("strong",[s._v("config/packages/security.yaml")]),s._v(".")]),s._v(" "),e("h2",{attrs:{id:"authentification"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authentification"}},[s._v("#")]),s._v(" Authentification")]),s._v(" "),e("h3",{attrs:{id:"la-classe-user"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#la-classe-user"}},[s._v("#")]),s._v(" La classe User")]),s._v(" "),e("p",[s._v("Le premier point qu'il nous faut régler afin de mettre en place notre système d'"),e("strong",[s._v("authentification")]),s._v(" est la création d'une classe implémentant l'interface "),e("strong",[s._v("Symfony/Component/Security/Core/User/UserInterface")]),s._v(". Cette classe sera nécessaire peu importe le type d'authentification qu'utilisera l'application (en base de données, via OAuth avec Facebook, sur un LDAP, ...).")]),s._v(" "),e("p",[s._v("Encore une fois, le "),e("strong",[s._v("MakerBundle")]),s._v(" va nous aider à mettre en place rapidement cette classe avec une commande interactive !")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("php bin/console make:user\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("Voici les réponses que nous allons fournir aux différentes questions de la commande :")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("The name of the security user class "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g. User"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("User"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" User\n\nDo you want to store user data "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the database "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("via Doctrine"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("? "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("yes/no"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("yes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n\nEnter a property name that will be the unique "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"display"')]),s._v(" name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the user "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g.\nemail, username, uuid "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("email"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" username\n\nDoes this app need to hash/check user passwords? "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("yes/no"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("yes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("Nous avons donc créer une entité Doctrine "),e("strong",[s._v("App\\Entity\\User")]),s._v(" qui se connectera avec un nom d'utilisateur et l'application sera chargée de gérer le hachage des mots de passe.")]),s._v(" "),e("p",[s._v("La commande a donc :")]),s._v(" "),e("ol",[e("li",[s._v("Créée une entité User et son repository.")]),s._v(" "),e("li",[s._v("Implémentée l'interface correctement en fonction de nos réponses.")]),s._v(" "),e("li",[s._v("Modifiée le fichier de configuration "),e("strong",[s._v("security.yaml")]),s._v(".")])]),s._v(" "),e("p",[s._v("Voici la configuration qui a changé :")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("security")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("encoders")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("App\\Entity\\User")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("algorithm")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" auto\n\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("providers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app_user_provider")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("entity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("class")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" App\\Entity\\User\n                "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("property")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" username\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("La clé "),e("strong",[s._v("encoders")]),s._v(" permet de préciser que pour notre classe "),e("strong",[s._v("App\\Entity\\User")]),s._v(", les mots de passe seront encodés avec l'algorithme "),e("strong",[s._v("auto")]),s._v(". Ce dernier correspond en faite à la constante "),e("strong",[s._v("PASSWORD_DEFAULT")]),s._v(" de la méthode PHP "),e("a",{attrs:{href:"https://www.php.net/manual/fr/function.password-hash.php",target:"_blank",rel:"noopener noreferrer"}},[s._v("password_hash"),e("OutboundLink")],1),s._v(". En ce moment, c'est "),e("strong",[s._v("bcrypt")]),s._v(" qui est considéré comme le meilleur algorithme pour les mots de passe pour "),e("strong",[s._v("PHP")]),s._v(".")]),s._v(" "),e("p",[s._v("La clé "),e("strong",[s._v("providers")]),s._v(" configure les différents "),e("strong",[s._v("User Providers")]),s._v(".")]),s._v(" "),e("h3",{attrs:{id:"les-user-providers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#les-user-providers"}},[s._v("#")]),s._v(" Les User Providers")]),s._v(" "),e("p",[s._v("Pour indiquer à l'application comment trouver nos utilisateurs, elle aura besoin de savoir comment si prendre. C'est le but du "),e("strong",[s._v("User Provider")]),s._v(" qui a été configuré précédemment.")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),e("p",[s._v("Une fois connecté, l'utilisateur est chargé à chaque nouvelle requête.")])]),s._v(" "),e("p",[s._v("Puisque notre classe "),e("strong",[s._v("User")]),s._v(" est une entité "),e("strong",[s._v("Doctrine")]),s._v(", nous allons utiliser l'"),e("a",{attrs:{href:"https://symfony.com/doc/current/security/user_provider.html#entity-user-provider",target:"_blank",rel:"noopener noreferrer"}},[s._v("Entity User Provider"),e("OutboundLink")],1),s._v(". Ce "),e("strong",[s._v("provider")]),s._v(" utilisera lui-même "),e("strong",[s._v("Doctrine")]),s._v(" pour faire une requête en base de données afin d'y chercher notre utilisateur.")]),s._v(" "),e("p",[s._v("Il existe d'autre "),e("strong",[s._v("providers")]),s._v(" mis à disposition dont nous pouvons citer par exemple :")]),s._v(" "),e("ul",[e("li",[s._v("Le "),e("strong",[s._v("MemoryUserProvider")]),s._v(" qui sert principalement pour le développement et les tests")]),s._v(" "),e("li",[s._v("Le "),e("strong",[s._v("LdapUserProvider")]),s._v(" qui permet de se connecter avec un serveur "),e("strong",[s._v("LDAP")])])]),s._v(" "),e("p",[s._v("Vous pouvez également créer vos propres provider en implémentant l'interface "),e("strong",[s._v("Symfony\\Component\\Security\\Core\\User\\UserProviderInterface")]),s._v(".")]),s._v(" "),e("h3",{attrs:{id:"les-firewalls"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#les-firewalls"}},[s._v("#")]),s._v(" Les Firewalls")]),s._v(" "),e("p",[s._v("La configuration "),e("strong",[s._v("la plus importante")]),s._v(" de notre système de connexion se trouve sous la clé "),e("strong",[s._v("firewalls")]),s._v(".")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("security")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("firewalls")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dev")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ^/(_(profiler"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v("wdt)"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v("css"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v("images"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v("js)/\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("security")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("anonymous")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lazy\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lazy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provider")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" app_user_provider\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("Il y a actuellement "),e("strong",[s._v("deux firewalls")]),s._v(" définis par défaut :")]),s._v(" "),e("ul",[e("li",[s._v("Le firewall "),e("strong",[s._v("dev")]),s._v(" est seulement ici pour empêcher de bloquer accidentellement les outils de debug de Symfony.")]),s._v(" "),e("li",[s._v("Le firewall "),e("strong",[s._v("main")]),s._v(", qui correspond actuellement à toutes les URLs de notre application (car il n'y pas de clé "),e("em",[s._v("pattern")]),s._v(" définie).")])]),s._v(" "),e("p",[s._v("En effet, comme pour les routes, le "),e("strong",[s._v("premier firewall")]),s._v(" qui correspond à l'URL de la requête courante sera utilisé.")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),e("p",[s._v("La plupart du temps, la définition d'"),e("strong",[s._v("un seul firewall")]),s._v(" est nécessaire pour gérer tout le système d'authentification de notre application. C'est considéré comme une bonne pratique dans limiter le nombre.")])]),s._v(" "),e("p",[s._v("Le fait que le "),e("strong",[s._v("firewall main")]),s._v(" englobe toutes nos URLs ne veut pas dire pour autant qu'il faut absolument être connecté pour pouvoir accéder à notre contenu. La clé de configuration "),e("strong",[s._v("anonymous")]),s._v(" signifie que ce firewall accepte également les "),e("strong",[s._v("utilisateurs anonymes")]),s._v(". D'ailleurs, si vous jetez un coup d'oeil à la "),e("strong",[s._v("debug bar")]),s._v(", vous pourrez voir que actuellement nous utilisons un utilisateur anonyme :")]),s._v(" "),e("p",[e("img",{attrs:{src:"/img/anonymous.png",alt:"Debug bar anonymous user"}})]),s._v(" "),e("p",[s._v("La "),e("strong",[s._v("debug bar")]),s._v(" nous définie comme authentifier car notre firewall "),e("strong",[s._v("main")]),s._v(" correspond à l'URL de notre requête. Authentifié, certes, mais avec un utilisateur "),e("strong",[s._v("anonyme")]),s._v(" !")]),s._v(" "),e("h3",{attrs:{id:"authentication-providers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authentication-providers"}},[s._v("#")]),s._v(" Authentication Providers")]),s._v(" "),e("p",[s._v("Afin que nous puissions nous connecter, il va falloir configurer notre firewall "),e("strong",[s._v("main")]),s._v(" avec un "),e("strong",[s._v("Authentication Provider")]),s._v(".")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),e("p",[s._v("Notez qu'il est tout à fait possible d'avoir plusieurs "),e("strong",[s._v("Authentication Providers")]),s._v(" pour un seul firewall.")])]),s._v(" "),e("p",[s._v("Encore une fois, Symfony nous en fournit déjà quelqu'uns pour nous faciliter la tâche, dont les suivants :")]),s._v(" "),e("ul",[e("li",[s._v("form_login")]),s._v(" "),e("li",[s._v("json_login")]),s._v(" "),e("li",[s._v("http_basics")])]),s._v(" "),e("p",[s._v("Ceci sont très pratiques pour configurer rapidement un système de connexion mais ils ont l'inconvenient d'être plus dûrs à personnaliser. C'est pourquoi, il est conseillé d'utiliser un système plus complet, à savoir "),e("strong",[s._v("Guard")]),s._v(".")]),s._v(" "),e("h3",{attrs:{id:"guard-authenticator"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#guard-authenticator"}},[s._v("#")]),s._v(" Guard authenticator")]),s._v(" "),e("p",[s._v("L'avantage de "),e("strong",[s._v("Guard")]),s._v(" est qu'il nous donne "),e("strong",[s._v("plus de contrôle")]),s._v(" sur tout le processus de connexion. Le "),e("strong",[s._v("MakerBundle")]),s._v(" va nous permettre de rapidement générer les bases de notre système de connexion basé sur "),e("strong",[s._v("Guard")]),s._v(".")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("php bin/console make:auth\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("What style of authentication "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" you want? "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Empty authenticator"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Empty authenticator\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Login form authenticator\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\nThe class name of the authenticator to create "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g. AppCustomAuthenticator"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" LoginFormAuthenticator\n\nChoose a name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the controller class "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g. SecurityController"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SecurityController"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SecurityController\n\nDo you want to generate a "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/logout'")]),s._v(" URL? "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("yes/no"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("yes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("Cette commande a fait beaucoup pour nous :")]),s._v(" "),e("ol",[e("li",[s._v("Créée notre classe "),e("strong",[s._v("Guard")]),s._v(" "),e("strong",[s._v("App\\Security\\LoginFormAuthenticator")]),s._v(" qui contient tout le processus de connexion")]),s._v(" "),e("li",[s._v("Générée un "),e("strong",[s._v("SecurityController")]),s._v(" avec une action de "),e("strong",[s._v("login")]),s._v(" et une de "),e("strong",[s._v("logout")])]),s._v(" "),e("li",[s._v("Créée un template par défaut de login dans "),e("strong",[s._v("security/login.html.twig")])]),s._v(" "),e("li",[s._v("Complétée la configuration de notre firewall pour utiliser notre classe "),e("strong",[s._v("Guard")]),s._v(" et setup l'action de déconnexion")])]),s._v(" "),e("p",[s._v("N'hésitez pas à modifier le code ainsi généré afin de vous l'approprier. C'est votre code à présent !")]),s._v(" "),e("h2",{attrs:{id:"autorisation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#autorisation"}},[s._v("#")]),s._v(" Autorisation")]),s._v(" "),e("p",[s._v("Il y a des actions que seuls les utilisateurs connectés peuvent réaliser. Cependant, tous nos utilisateurs ne sont pas forcement égaux en droits (dans notre application, bien sûr).")]),s._v(" "),e("p",[s._v("Pour gérer ces différences d'autorisations, Symfony nous proposent plusieurs mécanismes, dont le premier est l'introduction de rôles pour les utilisateurs.")]),s._v(" "),e("h3",{attrs:{id:"les-roles"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#les-roles"}},[s._v("#")]),s._v(" Les roles")]),s._v(" "),e("p",[s._v("Si vous regardez votre classe User, vous voyez qu'elle dispose déjà d'une méthode "),e("strong",[s._v("getRoles()")]),s._v(" qui lui vient de l'interface "),e("strong",[s._v("UserInterface")]),s._v(".")]),s._v(" "),e("div",{staticClass:"language-php line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// App\\Entity\\User")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("getRoles")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword return-type"}},[s._v("array")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$roles")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("roles")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// guarantee every user at least has ROLE_USER")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$roles")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'ROLE_USER'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("array_unique")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$roles")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("Comme vous le voyez, tous nos "),e("strong",[s._v("User")]),s._v(" dispose du rôle "),e("strong",[s._v("ROLE_USER")]),s._v(" par défaut.")]),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),e("p",[s._v("Les rôles doivent toujours commencer par la chaîne de caractères "),e("strong",[s._v('"ROLE_"')]),s._v(" mais vous pouvez "),e("strong",[s._v("n'importe quel rôle")]),s._v(" qui a un sens dans votre application.")])]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),e("p",[s._v("Il est également possible de définir une "),e("strong",[s._v("hiérarchie de rôles")]),s._v(". Par exemple, pour que tous les utilisateurs ayant le ROLE_ADMIN possède également le ROLE_MODERATOR.")])]),s._v(" "),e("p",[s._v("Ces rôles nous seront utiles afin de limiter les différentes actions des utilisateurs.")]),s._v(" "),e("h4",{attrs:{id:"les-roles-speciaux"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#les-roles-speciaux"}},[s._v("#")]),s._v(" Les rôles spéciaux")]),s._v(" "),e("p",[s._v("Il existe trois rôles un peu particuliers car ils ne correspondent pas directement à des rôles d'utilisateurs :")]),s._v(" "),e("ul",[e("li",[s._v("Le rôle "),e("strong",[s._v("IS_AUTHENTICATED_ANONYMOUSLY")]),s._v(" est attribué à "),e("strong",[s._v("tous les utilisateurs")]),s._v(", qu'ils soient connectés ou non.")]),s._v(" "),e("li",[s._v("Le rôle "),e("strong",[s._v("IS_AUTHENTICATED_REMEMBERED")]),s._v(" est attribué à "),e("strong",[s._v("tous les utilisateurs connectés")]),s._v(", qu'ils utilisent la fonctionnalité de "),e("a",{attrs:{href:"https://symfony.com/doc/current/security/remember_me.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("remember_me"),e("OutboundLink")],1),s._v(" ou non.")]),s._v(" "),e("li",[s._v("Le rôle "),e("strong",[s._v("IS_AUTHENTICATED_FULLY")]),s._v(" est attribué à "),e("strong",[s._v("tous les utilisateurs connectés")]),s._v(" qui ne se sont pas connectés automatiquement avec la fonctionnalité de "),e("em",[s._v("remember_me")]),s._v(".")])]),s._v(" "),e("h3",{attrs:{id:"recuperer-l-utilisateur-connecte"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#recuperer-l-utilisateur-connecte"}},[s._v("#")]),s._v(" Récupérer l'utilisateur connecté")]),s._v(" "),e("p",[s._v("Maintenant que nos utilisateurs sont capables de se connecter, on va avoir besoin de les récupérer pour interagir avec eux. Pour cela nous disposons de plusieurs méthodes en fonction du contexte :")]),s._v(" "),e("h4",{attrs:{id:"depuis-un-controleur"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#depuis-un-controleur"}},[s._v("#")]),s._v(" Depuis un contrôleur")]),s._v(" "),e("p",[s._v("Si notre contrôleur étant l'"),e("strong",[s._v("AbstractController")]),s._v(", nous pouvons par exemple faire ceci :")]),s._v(" "),e("div",{staticClass:"language-php line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("index")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$currentUser")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUser")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("createAccessDeniedException")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("La méthode "),e("strong",[s._v("getUser()")]),s._v(" nous retourne l'utilisateur courant. Si ce n'est pas une instance de "),e("strong",[s._v("User")]),s._v(", nous pouvons envoyer une exception qui limitera l'accès.")]),s._v(" "),e("h4",{attrs:{id:"depuis-un-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#depuis-un-service"}},[s._v("#")]),s._v(" Depuis un service")]),s._v(" "),e("p",[s._v("La méthode précédente utilise en fait un service pour récupérer l'utilisateur que Symfony à pris soin d'injecter pour nous. Mais dans un de nos service, nous avons besoin de l'injecter nous même.")]),s._v(" "),e("div",{staticClass:"language-php line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token package"}},[s._v("Symfony"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Component"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Security"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Core"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Security")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[s._v("MonService")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$security")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("__construct")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[s._v("Security")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$security")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("security")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$security")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("someMethod")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("security")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUser")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h4",{attrs:{id:"depuis-un-template-twig"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#depuis-un-template-twig"}},[s._v("#")]),s._v(" Depuis un template Twig")]),s._v(" "),e("p",[s._v("Si vous vous rappelez le chapitre sur "),e("strong",[s._v("Twig")]),s._v(", nous avions vu qu'il existait un objet à disposition un peu particulier dans nos templates : la variable "),e("strong",[s._v("app")]),s._v(". En effet, cette variable nous permet de récupérer directement notre utilisateur dans nos templates Twig :")]),s._v(" "),e("div",{staticClass:"language-twig line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-twig"}},[e("code",[e("span",{pre:!0,attrs:{class:"token twig language-twig"}},[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("{# null ou une instance de notre classe User #}")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token twig language-twig"}},[e("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("{{")]),s._v(" dump"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("}}")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"limiter-l-acces-a-une-partie-de-notre-application"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#limiter-l-acces-a-une-partie-de-notre-application"}},[s._v("#")]),s._v(" Limiter l'accès à une partie de notre application")]),s._v(" "),e("p",[s._v("Il reste une dernière clé dont nous n'avons parlée dans notre ficher de configuration "),e("strong",[s._v("security.yaml")]),s._v(". Il s'agit de la clé "),e("strong",[s._v("access_control")]),s._v(".")]),s._v(" "),e("p",[s._v("Cette configuration permet de limiter l'accès à toute une partie de notre application.")]),s._v(" "),e("p",[s._v("Comme pour le firewall :")]),s._v(" "),e("ul",[e("li",[s._v("Une règle "),e("strong",[s._v("access_control")]),s._v(" regarde si le pattern de l'URL de la requête correspond")]),s._v(" "),e("li",[s._v("La premiere règle d'"),e("strong",[s._v("access_control")]),s._v(" qui correspond sera utilisé")])]),s._v(" "),e("p",[s._v("Par exemple :")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("security")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("access_control")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# On prend soin d'autoriser l'accès au login")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ^/admin/login"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roles")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IS_AUTHENTICATED_ANONYMOUSLY "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Tous les URLs commençant par /admin seront bloquées pour les utilisateurs n'ayant pas le rôle ROLE_ADMIN")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ^/admin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roles")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ROLE_ADMIN "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),e("p",[s._v("Une erreur courante consiste à autoriser l'accès à la connexion seulement aux utilisateurs connectés. Les utilisateurs anonymes ne peuvent donc plus se connecter. Garder ça à l'esprit !")])]),s._v(" "),e("h3",{attrs:{id:"verifiez-les-droits"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#verifiez-les-droits"}},[s._v("#")]),s._v(" Vérifiez les droits")]),s._v(" "),e("p",[s._v("Bien que nous savons maintenant comment empêcher un simple utilisateur d'accèder à notre back-office, nous pourrions avoir besoin d'avoir plus de contrôle sur ce qu'un modérateur pourrait y faire, par exemple.")]),s._v(" "),e("p",[s._v("Le service "),e("strong",[s._v("Symfony\\Component\\Security\\Core\\Authorization\\AuthorizationCheckerInterface")]),s._v(" va nous aider dans ce but.")]),s._v(" "),e("div",{staticClass:"language-php line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token package"}},[s._v("Symfony"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Component"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Security"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Core"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Authorization")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[s._v("AuthorizationCheckerInterface")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("isGranted")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$attribute")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$subject")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword return-type"}},[s._v("bool")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("Cette interface contient seulement une méthode "),e("strong",[s._v("isGranted()")]),s._v(" qui prend principalement un paramètre "),e("strong",[s._v("attribut")]),s._v(". Bien que cette "),e("strong",[s._v("attribut")]),s._v(" puisse être de n'importe quel type, nous allons nous contenter dans ce cours d'y insérer "),e("strong",[s._v("les rôles")]),s._v(" que nous voulons vérifier pour l'"),e("strong",[s._v("utilisateur courant")]),s._v(". Ainsi, nous pourrions faire dans un contrôleur :")]),s._v(" "),e("div",{staticClass:"language-php line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("index")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Cette méthode est un raccourci fournit par l'AbstractController")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// qui utilise en fait le service d'AuthorizationChecker")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("isGranted")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'ROLE_ADMIN'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token constant boolean"}},[s._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("createAccessDeniedException")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Ou alors plus court avec un autre helper de contrôleur")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// qui enverra l'exception dans le cas échéant")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("denyAccessUnlessGranted")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'ROLE_ADMIN'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("De la même façon, dans nos templates "),e("strong",[s._v("Twig")]),s._v(" afin d'afficher conditionnellement du HTML à nos utilisateurs :")]),s._v(" "),e("div",{staticClass:"language-twig line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-twig"}},[e("code",[e("span",{pre:!0,attrs:{class:"token twig language-twig"}},[e("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("{%")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token tag-name keyword"}},[s._v("if")]),s._v(" is_granted"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("'")]),s._v("IS_AUTHENTICATED_REMEMBERED"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("'")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("%}")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("li")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("a")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("href")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("#"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Se déconnecter"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("a")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("li")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token twig language-twig"}},[e("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("{%")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token tag-name keyword"}},[s._v("endif")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("%}")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"a-vous-de-jouer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-vous-de-jouer"}},[s._v("#")]),s._v(" A vous de jouer")]),s._v(" "),e("ol",[e("li",[s._v("Créez votre entité User grâce à la commande "),e("strong",[s._v("make:user")]),s._v(" et liez y vos "),e("strong",[s._v("Comment")]),s._v(".")]),s._v(" "),e("li",[s._v("Complétez vos "),e("strong",[s._v("fixtures")]),s._v(" pour y charger quelques utilisateurs. Prenez soit d'encoder le mot de passe grâce à l'injection du service "),e("strong",[s._v("Symfony\\Component\\Security\\Core\\Encoder\\UserPasswordEncoderInterface")]),s._v(".")]),s._v(" "),e("li",[s._v("Modifiez la "),e("strong",[s._v("page de détail d'un produit")]),s._v(" pour que le nom de l'utilisateur ayant commenté l'article y apparaisse.")]),s._v(" "),e("li",[s._v("Mettez en place le "),e("strong",[s._v("système de connexion")]),s._v(".")]),s._v(" "),e("li",[s._v("Intégrez les "),e("a",{attrs:{href:"/projects/shoefony-template-login.zip"}},[s._v("templates fournis")]),s._v(" dans votre système de connexion.")]),s._v(" "),e("li",[s._v("Autorisez l'ajout de commentaires seulement pour les "),e("strong",[s._v("utilisateurs connectés")]),s._v(" (dans le template et le contrôleur).")]),s._v(" "),e("li",[s._v("Créez un nouveau contrôleur "),e("strong",[s._v("AccountController")]),s._v(" dont toutes les URLs commenceront par "),e("strong",[s._v("/mon-compte")]),s._v(" et créez y deux actions basiques.")]),s._v(" "),e("li",[s._v("Limitez l'accès à toutes les URLS commençant par "),e("strong",[s._v("/mon-compte")]),s._v(" pour que seuls les utilisateurs connectés puissent y avoir accès.")])])])}),[],!1,null,null,null);t.default=n.exports}}]);