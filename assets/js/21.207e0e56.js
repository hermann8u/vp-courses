(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{419:function(s,e,t){"use strict";t.r(e);var a=t(56),n=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"les-services-avec-symfony"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#les-services-avec-symfony"}},[s._v("#")]),s._v(" Les services avec Symfony")]),s._v(" "),t("p",[s._v("Notre application est déjà remplie de services. Par exemple, dans le chapitre sur les formulaires, nous avons utilisé le "),t("strong",[s._v("FlashBag")]),s._v(" afin de gérer les messages flash.")]),s._v(" "),t("p",[s._v("Vous l'aurez compris, les services sont omniprésent à travers le framework. Ils sont chacun responsable de tâches bien spécifiques. Parmi les services que nous avons déjà utilisés sans que vous vous en aperceviez, nous pouvons citer :")]),s._v(" "),t("ul",[t("li",[s._v("Le Router")]),s._v(" "),t("li",[s._v("La FormFactory")]),s._v(" "),t("li",[s._v("Twig")]),s._v(" "),t("li",[s._v("La Session")])]),s._v(" "),t("p",[s._v("Ces services sont un peu particuliers car ils sont mis à disposition de manière transparente à travers des méthodes de l'"),t("strong",[s._v("AbstractController")]),s._v(" que nos contrôleurs étendent.")]),s._v(" "),t("h2",{attrs:{id:"les-services"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#les-services"}},[s._v("#")]),s._v(" Les services")]),s._v(" "),t("h3",{attrs:{id:"creer-un-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#creer-un-service"}},[s._v("#")]),s._v(" Créer un service")]),s._v(" "),t("p",[s._v("Le but des services restent de segmenter notre code en briques réutilisables plus petites. Vous l'aurez compris, nous allons utiliser l'autowiring dans notre application. Ainsi, la création de service consiste simplement en la création d'une classe !")]),s._v(" "),t("p",[s._v("Imaginons que nous voudrions afficher un message aléatoire sur plusieurs pages de notre site, nous pourrions le faire à partir d'un service :")]),s._v(" "),t("div",{staticClass:"language-php line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Ici le namespace est App\\Service mais ça aurait pu être App\\NimporteQuoi.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Nous verrons après pourquoi.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[s._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[s._v("MessageGenerator")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("getRandomMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword return-type"}},[s._v("string")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$messages")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'You did it! You updated the system! Amazing!'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'That was one of the coolest updates I\\'ve seen all day!'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'Great work! Keep going!'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$index")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("array_rand")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$messages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$messages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("Il ne nous reste plus qu'à l'utiliser")]),s._v(" "),t("h3",{attrs:{id:"utiliser-un-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#utiliser-un-service"}},[s._v("#")]),s._v(" Utiliser un service")]),s._v(" "),t("p",[s._v("L'utilisation d'un service se réduira à utiliser l'injection de dépendance, encore une fois, sans étape de configuration supplémentaire grâce à l'autowiring :")]),s._v(" "),t("div",{staticClass:"language-php line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[s._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("MessageGenerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[s._v("ProductController")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** @var MessageGenerator */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$messageGenerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("__construct")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[s._v("MessageGenerator")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$messageGenerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("messageGenerator")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$messageGenerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('/**\n    * @Route("/products")\n    */')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("list")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name return-type"}},[s._v("Response")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$message")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("messageGenerator")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRandomMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("Vous l'aurez peut être compris, nos contrôleurs sont eux-meme des services, sinon, l'exemple précédent ne serait pas possible.")])]),s._v(" "),t("h3",{attrs:{id:"lister-les-services-graces-a-la-console"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lister-les-services-graces-a-la-console"}},[s._v("#")]),s._v(" Lister les services grâces à la console")]),s._v(" "),t("p",[s._v("Afin de "),t("strong",[s._v("lister tous les services")]),s._v(" que vous pouvez injecter avec l'"),t("strong",[s._v("autowiring")]),s._v(", vous pouvez utiliser la commande suivante:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("php bin/console debug:autowiring\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Certains services sont également utilisés par Symfony pour réaliser des tâches "),t("strong",[s._v("internes au framework")]),s._v(". Ils ne sont pas forcement disponible pour l'autowiring car vous n'avez pas besoin de les utiliser. Il existe quand même une commande pour "),t("strong",[s._v("lister tous les services de l'application")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("php bin/console debug:container\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[s._v("#")]),s._v(" Configuration")]),s._v(" "),t("p",[s._v("Nous n'y échapperons pas, il faut quand même jetez un coup d'oeil au fichier de configuration "),t("strong",[s._v("/config/services.yaml")]),s._v(" pour voir comment ça fonctionne :")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# default configuration for services in *this* file")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("_defaults")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("autowire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Automatically injects dependencies in your services.")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("autoconfigure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Automatically registers your services as commands, event subscribers, etc.")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# makes classes in src/ available to be used as services")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this creates a service per class whose id is the fully-qualified class name")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("App\\")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../src/'")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exclude")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../src/DependencyInjection/'")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../src/Entity/'")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../src/Kernel.php'")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../src/Tests/'")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("Sous la clé "),t("em",[s._v("services._defaults")]),s._v(", on définie une configuration globales pour tous les services que nous allons déclarer. Nous indiquons ensuite à Symfony de considérer tous les fichiers du namespace App comme étant des services, en prenant soin d'exclure quelques exceptions.")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("Dans le cas des "),t("strong",[s._v("contrôleurs")]),s._v(", on peut injecter les services soit avec le "),t("strong",[s._v("constructeur")]),s._v(", soit dans nos "),t("strong",[s._v("actions")]),s._v(" directement. Si les deux méthodes fonctionnent, on préférera utiliser uniquement l'injection depuis le constructeur, notamment afin d'éviter de mélanger les paramètres qui proviennent du routing avec les dépendances.")])]),s._v(" "),t("h2",{attrs:{id:"les-parametres"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#les-parametres"}},[s._v("#")]),s._v(" Les paramètres")]),s._v(" "),t("p",[s._v("Nous allons profiter d'être dans le fichier "),t("strong",[s._v("/config/services.yaml")]),s._v(" pour parler des paramètres de l'application. Ils peuvent d'ailleurs être, à juste titre, utilisés comme des dépendances pour nos services.")]),s._v(" "),t("h3",{attrs:{id:"utilite-et-definition"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#utilite-et-definition"}},[s._v("#")]),s._v(" Utilité et définition")]),s._v(" "),t("p",[s._v("Nous avons déjà vu que les paramètres sensibles et ceux dépendant de la machine se gèrent dans les fichiers "),t("strong",[s._v("/.env*")]),s._v(", mais il peut être intéressant de disposer d'autres paramètres en rapport direct avec notre projet. Par exemple, la langue par défaut de notre site, ou l'adresse email de réception pour notre formulaire de contact.")]),s._v(" "),t("p",[s._v("Au lieu de définir en dure et à plusieurs endroits ces paramètres, nous pouvons les définir dans ce fichier sous la clé "),t("strong",[s._v("parameters")]),s._v(" :")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app.locale")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'fr'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app.email_address.contact")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'contact@shoefony.com'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"utilisation-dans-la-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#utilisation-dans-la-configuration"}},[s._v("#")]),s._v(" Utilisation dans la configuration")]),s._v(" "),t("p",[s._v("Maintenant qu'ils sont définis, on peut les utiliser dans toutes la configuration. Nous allons modifier la locale par défaut de notre site dans le fichier "),t("strong",[s._v("/config/packages/framework.yaml")]),s._v(" :")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("framework")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default_locale")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%app.locale%'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("Comme vous pouvez le voir, pour les utiliser dans la configuration, il suffit d'entourer le nom que nous avons utilisé pour définir le paramètre par "),t("strong",[s._v("deux symboles %")]),s._v(". D'ailleurs, les paramètres se concatènent très bien avec une autre chaîne de caractères. Par exemple dans le fichier de configuration de Twig :")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("twig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default_path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%kernel.project_dir%/templates'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("Dans cet exemple, nous utilisons un paramètre fournit par Symfony qui contient le chemin complet vers la racine de notre projet. C'est très souvent utilisé pour obtenir le chemin complet vers un fichier, ou ici un dossier, en concaténant.")])]),s._v(" "),t("h3",{attrs:{id:"utilisation-dans-un-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#utilisation-dans-un-service"}},[s._v("#")]),s._v(" Utilisation dans un service")]),s._v(" "),t("p",[s._v("Les paramètres peuvent aussi s'injecter en dépendances de services avec l'autowiring ! Mais pour que ça fonctionne, il faut faire un peu de configuration :")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app.locale")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'fr'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app.email_address.contact")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'contact@shoefony.com'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("_defaults")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("autowire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("autoconfigure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("string $projectDir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%kernel.project_dir%'")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("string $contactEmailAddress")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%app.email_address.contact%'")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("Voilà qui permet d'obtenir ces deux paramètres de manière global pour l'injection de dépendances. Pour que ça fonctionne, il faut que le type et le nom de l'argument du constructeur du service correspondent avec ceux définis sous la clé "),t("strong",[s._v("bind")]),s._v(" :")]),s._v(" "),t("div",{staticClass:"language-php line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[s._v("AnotherService")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** @var string */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$projectDir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("__construct")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword type-hint"}},[s._v("string")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$projectDir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("projectDir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$projectDir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h2",{attrs:{id:"exemple-utilisation-du-mailer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#exemple-utilisation-du-mailer"}},[s._v("#")]),s._v(" Exemple : Utilisation du Mailer")]),s._v(" "),t("p",[s._v("Nous allons maintenant pouvoir pratiquer l'injection de dépendances avec un cas concret : l'utilisation du "),t("a",{attrs:{href:"https://symfony.com/doc/current/components/mailer.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("composant Mailer"),t("OutboundLink")],1),s._v(".")]),s._v(" "),t("p",[s._v("Ce composant est, comme beaucoup, intégré à Symfony à travers le "),t("strong",[s._v("FrameworkBundle")]),s._v(".")]),s._v(" "),t("p",[s._v("Afin de l'utiliser, il faut commencer par le configurer, mais Symfony Flex a déjà fait une bonne partie du travail pour nous. Voici les étapes étapes qu'il nous reste à faire :")]),s._v(" "),t("ol",[t("li",[s._v("Installer un "),t("a",{attrs:{href:"https://symfony.com/doc/current/mailer.html#using-a-3rd-party-transport",target:"_blank",rel:"noopener noreferrer"}},[s._v("provider"),t("OutboundLink")],1),s._v(" pour l'envoi d'email en fonction de vos besoin ou utiliser le "),t("strong",[s._v("SMTP")]),s._v(" (par défaut)")]),s._v(" "),t("li",[s._v("Comme nous ne l'avons pas encore fait, il faut dupliquer le fichier "),t("strong",[s._v("/.env")]),s._v(" en "),t("strong",[s._v("/.env.local")]),s._v(" afin d'y ajouter vos données sensibles.")]),s._v(" "),t("li",[s._v("Dans le fichier "),t("strong",[s._v("/.env.local")]),s._v(", modifier le paramètre "),t("strong",[s._v("MAILER_DSN")]),s._v(" en "),t("a",{attrs:{href:"https://symfony.com/doc/current/components/mailer.html#mailer-dsn",target:"_blank",rel:"noopener noreferrer"}},[s._v("fonction du provider choisit"),t("OutboundLink")],1)])]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),t("p",[s._v("L'envoi de mail en locale est toujours quelque chose qui reste bancale. C'est possible que, même si votre configuration est bonne, rien ne se passe.")])]),s._v(" "),t("h3",{attrs:{id:"l-envoi-d-un-email"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#l-envoi-d-un-email"}},[s._v("#")]),s._v(" L'envoi d'un email")]),s._v(" "),t("p",[s._v("Le composant fonctionne grâce à la création, la configuration et enfin à l'envoi d'objets "),t("strong",[s._v("Symfony\\Component\\Mime\\Email")]),s._v(". Le service "),t("strong",[s._v("Mailer")]),s._v(" est responsable de l'envoi réel du message à travers sa méthode "),t("strong",[s._v("send")]),s._v(".")]),s._v(" "),t("p",[s._v("Voici comment générer un message :")]),s._v(" "),t("div",{staticClass:"language-php line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[s._v("Symfony"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Component"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Mailer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("MailerInterface")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[s._v("Symfony"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Component"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Mime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Email")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$email")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Email")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'hello@example.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'contact@shoefony.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//->cc('cc@example.com')")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//->bcc('bcc@example.com')")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//->replyTo('hello@example.com')")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//->priority(Email::PRIORITY_HIGH)")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("subject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'Un message de contact sur Shoefony'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$twig")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("render")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'email/contact.html.twig'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'contact'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$contact")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mailer")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$email")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("Pour garder les choses découplées, le corps de l'email a été stocké dans un template et est rendu grâce à la méthode "),t("strong",[s._v("render()")]),s._v(" de la classe "),t("strong",[s._v("Twig\\Environment")]),s._v(".")]),s._v(" "),t("p",[s._v("L'objet "),t("strong",[s._v("Symfony\\Component\\Mime\\Email")]),s._v(" supporte beaucoup plus d'options, comme inclure des pièces jointes, et bien plus encore.")]),s._v(" "),t("p",[s._v('A noter qu\'en plus d\'indiquer des adresses "to", vous pouvez ajouter des destinataires en copie ou copie cachée via "cc", etc...')]),s._v(" "),t("h3",{attrs:{id:"analyser-ses-envois"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#analyser-ses-envois"}},[s._v("#")]),s._v(" Analyser ses envois")]),s._v(" "),t("p",[s._v("Vous pouvez voir tous les emails envoyés durant une unique réponse lorsque vous êtes dans l'environnement dev via "),t("strong",[s._v("la barre de debug")]),s._v(". L'icône d'email dans la barre d'outils montrera combien d'emails ont été envoyés. Si vous cliquez dessus, un rapport s'ouvrira montrant les détails des emails envoyés.")]),s._v(" "),t("p",[s._v("Si vous envoyez un email et puis redirigez immédiatement vers une autre page, la barre d'outils de debug n'affichera pas d'icône d'email ni de rapport sur la page d'après.")]),s._v(" "),t("p",[s._v("Il est possible d'"),t("strong",[s._v("intercepter cette redirection")]),s._v(" grâce à une configuration du "),t("strong",[s._v("WebProfilerBundle")]),s._v(". Nous allons activer cette option uniquement pour le développement, dans le fichier "),t("strong",[s._v("/config/dev/web_profiler.yaml")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web_profiler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("toolbar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("intercept_redirects")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"a-vous-de-jouer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#a-vous-de-jouer"}},[s._v("#")]),s._v(" A vous de jouer")]),s._v(" "),t("p",[s._v("Améliorons à présent notre formulaire de contact afin d'alerter l'administrateur lorsqu'une nouvelle demande est envoyée.")]),s._v(" "),t("ol",[t("li",[s._v("Ajoutez les paramètres "),t("strong",[s._v("app.locale")]),s._v(" et "),t("strong",[s._v("app.email_address.contact")]),s._v(" dans le bon fichier et configurez la locale par défaut de votre application avec le premier.")]),s._v(" "),t("li",[s._v("Ajoutez le "),t("strong",[s._v("bind")]),s._v(" pour le paramètre "),t("strong",[s._v("app.email_address.contact")]),s._v(".")]),s._v(" "),t("li",[s._v("Configurez le composant "),t("strong",[s._v("Mailer")]),s._v(" afin de pouvoir envoyer des emails depuis votre projet.")]),s._v(" "),t("li",[s._v("Créez un service "),t("strong",[s._v("App\\Mailer\\ContactMailer")]),s._v(" et injectez-y le service "),t("strong",[s._v("Mailer")]),s._v(", le service de "),t("strong",[s._v("Twig")]),s._v(" et le paramètre "),t("strong",[s._v("app.email_address.contact")]),s._v(". Vérifiez ensuite que ça fonctionne avec la fonction de debug "),t("strong",[s._v("dd()")]),s._v(".")]),s._v(" "),t("li",[s._v("Ajoutez une méthode "),t("strong",[s._v("send")]),s._v(" qui prendra en paramètre notre entité de contact et qui utilisera les dépendances de notre service pour procéder à l'envoi. Le contenu de l'email devra être généré grâce à Twig.")]),s._v(" "),t("li",[s._v("Injectez notre service dans le "),t("strong",[s._v("MainController")]),s._v(" et utilisez sa méthode après la validation des données.")]),s._v(" "),t("li",[s._v("Testez le résultat grâce à la barre de debug.")])]),s._v(" "),t("h2",{attrs:{id:"pour-aller-plus-loin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pour-aller-plus-loin"}},[s._v("#")]),s._v(" Pour aller plus loin")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://symfony.com/doc/current/best_practices.html#business-logic",target:"_blank",rel:"noopener noreferrer"}},[s._v("Symfony best practices : Organizing Your Business Logic"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://symfony.com/doc/current/best_practices.html#configuration",target:"_blank",rel:"noopener noreferrer"}},[s._v("Symfony best practices : Configuration"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://symfony.com/doc/current/mailer.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Documentation de Symfony sur l'envoi d'email"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=n.exports}}]);