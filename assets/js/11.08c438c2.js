(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{408:function(s,t,a){"use strict";a.r(t);var e=a(56),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"les-entites-doctrine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#les-entites-doctrine"}},[s._v("#")]),s._v(" Les entités Doctrine")]),s._v(" "),a("p",[s._v("L'objectif d'un "),a("strong",[s._v("Object-Relation Mapper")]),s._v(" (ORM) est le suivant : se charger de l'enregistrement de vos données en vous faisant oublier que vous avez une base de données. Comment ? En s'occupant de tout ! Nous n'allons plus écrire de requêtes, ni créer de tables via phpMyAdmin. Dans notre code PHP, nous allons utiliser "),a("strong",[s._v("Doctrine")]),s._v(", l'ORM par défaut de Symfony.")]),s._v(" "),a("h2",{attrs:{id:"creer-une-entite"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creer-une-entite"}},[s._v("#")]),s._v(" Créer une entité")]),s._v(" "),a("p",[s._v("Une entité, ce que l'ORM va manipuler et enregistrer dans la base de données, n'est rien d'autre qu'un "),a("strong",[s._v("Plain Old PHP Object")]),s._v(" représenté par une classe à créer au sein du répertoire "),a("strong",[s._v("Entity")]),s._v(" de notre projet. Cette entité correspondra à une table de notre base de données.")]),s._v(" "),a("p",[s._v("Voici ce à quoi pourrait ressembler l'entité "),a("strong",[s._v("Product")]),s._v(" de notre site :")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("App"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Entity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Store")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[s._v("Product")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token keyword type-hint"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword type-declaration"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword type-declaration"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword type-declaration"}},[s._v("float")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$price")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Getters and Setters ...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("Comme vous pouvez le voir, il n'y a pas grand chose. Un objet, des propriétés, et bien sûr, les getters / setters correspondants.")]),s._v(" "),a("p",[s._v("On pourrait en réalité utiliser notre objet dès maintenant, mais l'ORM ne pourrait pour le moment pas enregistrer notre objet en base de données.")]),s._v(" "),a("p",[s._v("Nous avions déjà créer une entité dans le chapitre sur les formulaires, "),a("strong",[s._v("App\\Entity\\Contact")]),s._v(", mais elles pour l'instant encore toutes les deux incomplètes. En effet, afin que Doctrine puisse savoir quoi faire de nos entités, il va falloir lui indiquer à l'aide d'"),a("strong",[s._v("attributes")]),s._v(".")]),s._v(" "),a("p",[s._v("Pour générer nos entités, nous n'allons pas le faire manuellement, mais nous servir de la commande mis à disposition par le "),a("strong",[s._v("maker-bundle")]),s._v(" :")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("php bin/console make:entity Store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Product\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),a("p",[s._v("Vous avez remarqué le double anti-slash. Il est probable qu'avec Windows vous ayez une erreur. Si c'est le cas, essayez alors avec un seul anti-slash.")])]),s._v(" "),a("p",[s._v("Lorsqu'on l'exécute, elle nous guide pour générer les différentes propriétés en nous demandant, dans l'ordre et pour chacune :")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Son nom")]),s._v(" : A donner en "),a("strong",[s._v("camelCase")]),s._v(", bien sûr, et "),a("strong",[s._v("sans le $")]),s._v(". Dans la base, il est par défaut convertit en "),a("em",[s._v("snake_case")])]),s._v(" "),a("li",[a("strong",[s._v("Son type Doctrine")]),s._v(' : Vous pouvez rentrer "?" pour lister tous les types disponibles')]),s._v(" "),a("li",[a("strong",[s._v("Différentes configurations")]),s._v(" : Dépend du type choisi")]),s._v(" "),a("li",[a("strong",[s._v("Si elle est nullable")]),s._v(" : De type booléen pour la configuration de la base de données. Par défaut à "),a("em",[s._v("false")])])]),s._v(" "),a("p",[s._v("Les "),a("strong",[s._v("Getters")]),s._v(" et "),a("strong",[s._v("Setters")]),s._v(" seront également générés pour nous. L'avantage est que, là encore, le code généré suit des conventions, notamment de typage pour nos Getters et Setters.")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("Pour modifier une entité qui existe déjà, vous pouvez utiliser la même commande, ce qui permettra d'ajouter de nouvelles propriétés.")])]),s._v(" "),a("p",[s._v("Voici ce que ça donne pour notre nouvelle entité "),a("strong",[s._v("App\\Entity\\Store\\Product")]),s._v(" :")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("strict_types"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("App"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Entity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Store")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("App"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Repository"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("ProductRepository")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("Doctrine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("DBAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Types")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("Doctrine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Mapping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ORM")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#[")]),a("span",{pre:!0,attrs:{class:"token attribute-content"}},[a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name class-name-fully-qualified"}},[s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Entity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name"}},[s._v("repositoryClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name"}},[s._v("ProductRepository")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#[")]),a("span",{pre:!0,attrs:{class:"token attribute-content"}},[a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name class-name-fully-qualified"}},[s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'sto_product'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[s._v("Product")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#[")]),a("span",{pre:!0,attrs:{class:"token attribute-content"}},[a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name class-name-fully-qualified"}},[s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Id")])]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("]")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#[")]),a("span",{pre:!0,attrs:{class:"token attribute-content"}},[a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name class-name-fully-qualified"}},[s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("GeneratedValue")])]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("]")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#[")]),a("span",{pre:!0,attrs:{class:"token attribute-content"}},[a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name class-name-fully-qualified"}},[s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Column")])]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("]")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token keyword type-hint"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#[")]),a("span",{pre:!0,attrs:{class:"token attribute-content"}},[a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name class-name-fully-qualified"}},[s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Column")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name"}},[s._v("length")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("]")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword type-declaration"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#[")]),a("span",{pre:!0,attrs:{class:"token attribute-content"}},[a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name class-name-fully-qualified"}},[s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Column")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name"}},[s._v("Types")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TEXT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("]")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword type-declaration"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#[")]),a("span",{pre:!0,attrs:{class:"token attribute-content"}},[a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name class-name-fully-qualified"}},[s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Column")])]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("]")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword type-declaration"}},[s._v("float")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$price")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#[")]),a("span",{pre:!0,attrs:{class:"token attribute-content"}},[a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name class-name-fully-qualified"}},[s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Column")])]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("]")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name class-name-fully-qualified type-declaration"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("DateTimeImmutable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$createdAt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("__construct")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword type-hint"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword type-hint"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword type-hint"}},[s._v("float")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$price")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("description")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("price")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$price")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("createdAt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name class-name-fully-qualified"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("DateTimeImmutable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Getters and Setters ...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("J'ai surligné la "),a("strong",[s._v("ligne 9")]),s._v(" qui n'a pas été ajoutée par la commande. Elle permet de définir le nom que nous voulons pour notre table en base de données, ce qui m'a permit d'ajouter le prefix \"sto_\" pour celle-ci.")])]),s._v(" "),a("p",[s._v("Grâce à ces "),a("strong",[s._v("attributes")]),s._v(", que l'on appelle "),a("strong",[s._v("metadata")]),s._v(", Doctrine dispose de toutes les informations nécessaires pour utiliser notre objet :")]),s._v(" "),a("ul",[a("li",[s._v("Créer la table correspondante")]),s._v(" "),a("li",[s._v("L'enregistrer")]),s._v(" "),a("li",[s._v("Définir un identifiant (id) en auto-incrément")]),s._v(" "),a("li",[s._v("Nommer les colonnes")]),s._v(" "),a("li",[s._v("etc.")])]),s._v(" "),a("h2",{attrs:{id:"gerer-l-etat-de-la-base-de-donnees"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gerer-l-etat-de-la-base-de-donnees"}},[s._v("#")]),s._v(" Gérer l'état de la base de données")]),s._v(" "),a("p",[s._v("Avant de pouvoir utiliser notre entité comme il se doit, on doit d'abord créer la table correspondante dans la base de données. Pour ce faire, il faut commencer par configurer nos accès à la base de données dans le fichier "),a("strong",[s._v("/.env.local")]),s._v(", en y modifiant la variable "),a("strong",[s._v("DATABASE_URL")]),s._v(".")]),s._v(" "),a("p",[s._v("Et ensuite, encore des "),a("strong",[s._v("commandes")]),s._v(" ! Cette fois-ci, on ne va pas utiliser une commande du maker-bundle, mais une des commandes de Doctrine, car on ne veut pas générer du code mais une "),a("strong",[s._v("table dans la base de données")]),s._v(".")]),s._v(" "),a("p",[s._v("D'abord, si vous ne l'avez pas déjà fait, il faut créer la base de données. Pour cela, il suffit d'exécuter la commande (vous n'avez à le faire qu'une seule fois évidemment) :")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("php bin/console doctrine:database:create\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"les-migrations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#les-migrations"}},[s._v("#")]),s._v(" Les migrations")]),s._v(" "),a("p",[s._v("Afin de modifier la structures de notre base de données, nous allons utiliser un autre bundle : "),a("strong",[s._v("DoctrineMigrationsBundle")]),s._v(".")]),s._v(" "),a("p",[s._v("Premièrement, nous allons "),a("strong",[s._v("comparer l'état actuel de notre base de données")]),s._v(" avec les informations que nous avons fournit à Doctrine à travers "),a("strong",[s._v("les métadata des entités")]),s._v(" :")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("php bin/console doctrine:migrations:diff\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Pour l'instant, rien n'a modifié notre base de données. Cette commande à générer un fichier pour nous dans le dossier "),a("strong",[s._v("migrations")]),s._v(" (depuis la racine du projet). Dans celle-ci se trouvent deux méthodes intéressantes :")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("up")]),s._v(" qui contient tout le SQL à éxécuter pour que notre base de données soit à jour.")]),s._v(" "),a("li",[a("strong",[s._v("down")]),s._v(" qui contient le SQL pour revenir à l'état précédant.")])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("Pensez à toujours vérifier ces requêtes, pour être sûrs de ne pas avoir fait d'erreur dans le mapping des entités.")])]),s._v(" "),a("p",[s._v("Mais maintenant, il est temps de passer aux choses sérieuses, et d'"),a("strong",[s._v("exécuter concrètement")]),s._v(" ce SQL avec la commande suivante :")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("php bin/console doctrine:migrations:migrate\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Si tout se passe bien, en ouvrant "),a("strong",[s._v("phpMyAdmin")]),s._v(" et en allant dans votre base de données vous devriez pouvoir constater le résultat. Les tables correspondantes aux entités ont été créées et les annotations prises en compte pour tous les champs.")]),s._v(" "),a("p",[s._v("Vous pouvez également "),a("strong",[s._v("modifier")]),s._v(" une entité depuis sa classe (ou avec la commande make:entity) en y ajoutant ou en retirant des champs. Une fois l'opération réalisée et le fichier enregistré, il vous faudra "),a("strong",[s._v("relancer les commandes précédentes")]),s._v(".")]),s._v(" "),a("h2",{attrs:{id:"interagir-avec-doctrine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interagir-avec-doctrine"}},[s._v("#")]),s._v(" Interagir avec Doctrine")]),s._v(" "),a("p",[s._v("Doctrine est un projet très complet qui est constitué de plusieurs packages, dont principalement :")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Le DBAL")]),s._v(" (Doctrine Abstraction layer) : C'est la couche "),a("strong",[s._v("bas niveau")]),s._v(" de Doctrine. Elle consiste principalement en une "),a("strong",[s._v("abstraction de PDO")]),s._v(" et permet donc de fournir une interface commune, "),a("strong",[s._v("peu importe le SGDB utilisé")]),s._v(" (MySQL, PostgreSQL, ...).")]),s._v(" "),a("li",[a("strong",[s._v("L'ORM")]),s._v(" : C'est la couche "),a("strong",[s._v("haut niveau")]),s._v(", qui nous permet de manipuler nos entités, rendant transparentes la plupart des interactions que l'on pourrait avoir avec la base de données. On utilisera dans ce but principalement l'"),a("strong",[s._v("EntityManager")]),s._v(".")])]),s._v(" "),a("p",[s._v("Voici comment injecter cet "),a("strong",[s._v("EntityManager")]),s._v(", encore une fois, en typant sur son interface :")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("Doctrine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("EntityManagerInterface")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("__construct")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[s._v("EntityManagerInterface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$em")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("C'est avec l'"),a("strong",[s._v("EntityManager")]),s._v(" que l'on va passer le plus clair de notre temps. C'est lui qui permet de dire à Doctrine « Persiste cet objet », c'est lui qui va exécuter les requêtes SQL (que l'on ne verra jamais car nous utilisons une couche d'abstraction), bref, c'est lui qui fera tout.")]),s._v(" "),a("p",[s._v("La seule chose qu'il ne sait pas faire facilement, c'est récupérer les entités depuis la base de données. Pour faciliter l'accès aux objets, on va utiliser des "),a("strong",[s._v("Repository")]),s._v(".")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("Lorsque vous avez généré votre entité avec la commande, elle a aussi généré le repository pour vous dans le dossier "),a("strong",[s._v("/src/Repository/")]),s._v(".")])]),s._v(" "),a("h3",{attrs:{id:"insertion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#insertion"}},[s._v("#")]),s._v(" Insertion")]),s._v(" "),a("p",[s._v("L'enregistrement effectif en base de données se fait en deux étapes depuis un service, dans lequel on a injecté au préalable l'"),a("strong",[s._v("EntityManager")]),s._v(" :")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Création de l'entité Product")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$product")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'Le nom'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDescription")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'Une super description'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setPrice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("129.99")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// Etape 1 : On "persiste" l\'entité')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("em")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("persist")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// Etape 2 : On "flush" tout ce qui a été persisté avant')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("em")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("flush")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("Remarquez la syntaxe utilisée pour créer l'instance de notre entité Product. Si on entoure la création d'un objet de parenthèses, on peut appeler directement ses méthodes dessus. De plus, on peut enchaîner les setters car il retourne tous une instance de l'objet sur lequel ils sont appelés.")])]),s._v(" "),a("p",[s._v("Ces quelques lignes permettent simplement d'"),a("strong",[s._v("enregistrer")]),s._v(" un nouveau produit en base de données à l'aide d'une "),a("strong",[s._v("requête INSERT")]),s._v(" classique que vous n'aurez jamais l'occasion de voir au niveau de votre code.")]),s._v(" "),a("h4",{attrs:{id:"transaction-sql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#transaction-sql"}},[s._v("#")]),s._v(" Transaction SQL")]),s._v(" "),a("p",[s._v("La création se fait en deux étapes:")]),s._v(" "),a("ul",[a("li",[s._v("La méthode "),a("strong",[s._v("persist")]),s._v(" indique à Doctrine que "),a("strong",[s._v("l'entité existe")]),s._v(" et qu'il peut "),a("strong",[s._v("traquer ses modifications")]),s._v(".")]),s._v(" "),a("li",[s._v("La méthode "),a("strong",[s._v("flush")]),s._v(" exécute toutes les insertions et modifications avec des requêtes SQL.")])]),s._v(" "),a("p",[s._v("Doctrine va en fait gérer des "),a("strong",[s._v("transactions SQL")]),s._v(". C'est à dire que lors de l'ajout de 10 produits, si l'une des insertions provoque une "),a("strong",[s._v("erreur SQL")]),s._v(", "),a("strong",[s._v("aucun")]),s._v(" des produits ne sera enregistré. La méthode "),a("strong",[s._v("flush")]),s._v(" exécute en fait la transaction.")]),s._v(" "),a("h4",{attrs:{id:"ajout-de-la-date-de-creation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ajout-de-la-date-de-creation"}},[s._v("#")]),s._v(" Ajout de la date de création")]),s._v(" "),a("p",[s._v("Il arrive régulièrement que l'on veuille enregistrer également la "),a("strong",[s._v("date de création")]),s._v(" d'une entité. Dans le cas de notre produit nous pouvons le faire, mais nous souhaiterions que cela soit réalisé de manière automatique à l'enregistrement de notre entité. Pour cela, il suffit d'aller modifier notre entité en y ajoutant "),a("strong",[s._v("une propriété date")]),s._v(" et "),a("strong",[s._v("un constructeur")]),s._v(" qui l'initialisera :")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#[")]),a("span",{pre:!0,attrs:{class:"token attribute-content"}},[a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name class-name-fully-qualified"}},[s._v("ORM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Column")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token attribute-class-name class-name"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'datetime'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name class-name-fully-qualified type-declaration"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("DateTime")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$createdAt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("__construct")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("createdAt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name class-name-fully-qualified"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("DateTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("getCreatedAt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name class-name-fully-qualified return-type"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("DateTime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("createdAt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("Bien entendu, après avoir effectué de telles modifications il va falloir, via la console, "),a("strong",[s._v("mettre à jour notre base de données")]),s._v(".")]),s._v(" "),a("h3",{attrs:{id:"modification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#modification"}},[s._v("#")]),s._v(" Modification")]),s._v(" "),a("p",[s._v("Après avoir vu comment enregistrer une nouvelle entité, voyons comment en "),a("strong",[s._v("récupérer")]),s._v(" une et la "),a("strong",[s._v("modifier")]),s._v(", toujours grâce à notre "),a("strong",[s._v("EntityManager")]),s._v(" :")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// On récupère le produit grâce au repository avec la méthode find()")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// qui prend en paramètre l'id de notre entité (SELECT ... WHERE id = 5)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$product")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("productRepository")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$product")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'Produit 5'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Pas besoin de persister car l'ORM connaît déjà notre entité, c'est lui qui vient de nous la fournir.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("em")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("flush")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("Dans ce cas, la méthode "),a("strong",[s._v("flush()")]),s._v(" n'effectue plus un INSERT dans notre base de données, mais un "),a("strong",[s._v("UPDATE")]),s._v(" de notre entité déjà existante (l'EntityManager de Doctrine gère ça tout seul). Vous constaterez dans l'exemple précédent l'utilisation de la méthode "),a("strong",[s._v("find()")]),s._v(" permettant d'aller récupérer un enregistrement par rapport à son identifiant. Il est également possible d'utiliser la méthode "),a("strong",[s._v("findAll()")]),s._v(" afin de récupérer l'ensemble des enregistrements.")]),s._v(" "),a("h3",{attrs:{id:"suppression"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#suppression"}},[s._v("#")]),s._v(" Suppression")]),s._v(" "),a("p",[s._v("De la même manière vous avez la possibilité d'exécuter une requête DELETE en utilisant la méthode "),a("strong",[s._v("remove()")]),s._v(" de l'"),a("strong",[s._v("EntityManager")]),s._v(" :")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$product")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("productRepository")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("em")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("em")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("flush")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"des-donnees-de-developpement"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#des-donnees-de-developpement"}},[s._v("#")]),s._v(" Des données de développement")]),s._v(" "),a("p",[s._v("Les "),a("strong",[s._v("fixtures")]),s._v(" sont utilisées pour charger un ensemble de données dans une base de données. Ces données peuvent être utilisées pour les tests ou peuvent être les données initiales nécessaires au bon fonctionnement de l'application.")]),s._v(" "),a("p",[s._v("La mise en place de fixtures nécessite l'utilisation d'un bundle :")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v(" require --dev doctrine/doctrine-fixtures-bundle\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ou en version courte grâce à Flex:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v(" req --dev orm-fixtures\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Flex a également créé un fichier de fixtures "),a("strong",[s._v("App\\DataFixtures\\AppFixtures")]),s._v(" que nous allons remplir de la façon suivante :")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("App"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("DataFixtures")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("App"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Entity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("Doctrine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Bundle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("FixturesBundle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Fixture")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("Doctrine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Common"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Persistence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("ObjectManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[s._v("AppFixtures")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fixture")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** @var ObjectManager */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$manager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("load")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[s._v("ObjectManager")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$manager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword return-type"}},[s._v("void")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("manager")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$manager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadProducts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("manager")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("flush")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("loadProducts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword return-type"}},[s._v("void")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$product")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'product '")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'Produit de description '")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("manager")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("persist")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("Vous pouvez écrire n'importe quoi pour générer vos fixtures donc si vous voulez être plus créatif, ne vous gênez pas ! Vous pouvez par exemple prendre exemple sur "),a("a",{attrs:{href:"https://github.com/symfony/demo/blob/master/src/DataFixtures/AppFixtures.php",target:"_blank",rel:"noopener noreferrer"}},[s._v("les fixtures de l'application de demo de Symfony"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("Il ne reste plus qu'à charger les fixtures en exécutant la commande suivante :")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ php bin/console doctrine:fixtures:load\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Les données présentent dans les fixtures devraient à présent avoir été intégrées dans votre base de données.")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),a("p",[s._v("Lorsque vous lancez la commande, elle vous demande de vider les données de votre base de données pour pouvoir s'exécuter, et ce à chaque fois.")])]),s._v(" "),a("h2",{attrs:{id:"a-vous-de-jouer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#a-vous-de-jouer"}},[s._v("#")]),s._v(" A vous de jouer")]),s._v(" "),a("p",[s._v("Rendons l'affichage de nos produits dynamique en créant une base de données et la table correspondante.")]),s._v(" "),a("ol",[a("li",[s._v("Configurez le projet Symfony afin de le lier à une base de données en paramétrant le fichier "),a("strong",[s._v("/.env.local")]),s._v(".")]),s._v(" "),a("li",[s._v("Créez l'entité "),a("strong",[s._v("App\\Entity\\Store\\Product")]),s._v(" et générez la table correspondante dans votre base de données comprenant les champs suivants : "),a("em",[s._v("id, name (string 255), description (text), price (float), created_at (datetime_immutable)")]),s._v(".")]),s._v(" "),a("li",[s._v("Complétez manuellement l'entité "),a("strong",[s._v("App\\Entity\\Contact")]),s._v(". Ajoutez également le "),a("strong",[s._v("createdAt")]),s._v(" et nommez sa table "),a("strong",[s._v("app_contact")])]),s._v(" "),a("li",[s._v("Enregistrez la demande de contact après validation du formulaire et avant d'envoyer cette dernière par email.")]),s._v(" "),a("li",[s._v("Mettre en place une classe gérant les "),a("strong",[s._v("fixtures")]),s._v(" et implémentez-y une boucle chargée de peupler votre table de "),a("strong",[s._v("14 produits")]),s._v(".")]),s._v(" "),a("li",[s._v("Affichez sur la page de "),a("strong",[s._v("listing des produits")]),s._v(" les fiches produits issues de la base de données, en pensant à afficher un message dans le cas où le catalogue ne dispose d'aucuns produits enregistrés.")]),s._v(" "),a("li",[s._v("Utilisez un "),a("strong",[s._v("filtre Twig")]),s._v(" permettant de toujours afficher le nom des produits avec une "),a("strong",[s._v("majuscule sur la première lettre")]),s._v(".")])]),s._v(" "),a("h2",{attrs:{id:"pour-aller-plus-loin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pour-aller-plus-loin"}},[s._v("#")]),s._v(" Pour aller plus loin")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://symfony.com/doc/current/bundles/DoctrineMigrationsBundle/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Documentation de Symfony sur le DoctrineMigrationsBundle"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);