<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Authentification et autorisations | Introduction à Symfony</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Licence Professionnelle SIL - Web et Mobile pour le Commerce Électronique">
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="preload" href="/assets/css/0.styles.e2f7dcf9.css" as="style"><link rel="preload" href="/assets/js/app.f5ffb287.js" as="script"><link rel="preload" href="/assets/js/2.85d345eb.js" as="script"><link rel="preload" href="/assets/js/20.2dd543f1.js" as="script"><link rel="prefetch" href="/assets/js/10.457dba52.js"><link rel="prefetch" href="/assets/js/11.08c438c2.js"><link rel="prefetch" href="/assets/js/12.cbc1776f.js"><link rel="prefetch" href="/assets/js/13.418be2c7.js"><link rel="prefetch" href="/assets/js/14.d52a0530.js"><link rel="prefetch" href="/assets/js/15.21450e21.js"><link rel="prefetch" href="/assets/js/16.872dd91c.js"><link rel="prefetch" href="/assets/js/17.b3e69a97.js"><link rel="prefetch" href="/assets/js/18.62e92111.js"><link rel="prefetch" href="/assets/js/19.e575b9c0.js"><link rel="prefetch" href="/assets/js/21.207e0e56.js"><link rel="prefetch" href="/assets/js/22.d2fc0852.js"><link rel="prefetch" href="/assets/js/23.d71aaa5c.js"><link rel="prefetch" href="/assets/js/24.4a856b70.js"><link rel="prefetch" href="/assets/js/25.886f50e9.js"><link rel="prefetch" href="/assets/js/26.7345d31d.js"><link rel="prefetch" href="/assets/js/27.98540e6e.js"><link rel="prefetch" href="/assets/js/28.6a30ed2d.js"><link rel="prefetch" href="/assets/js/29.932c0b60.js"><link rel="prefetch" href="/assets/js/3.0cf10e4b.js"><link rel="prefetch" href="/assets/js/30.aa92a368.js"><link rel="prefetch" href="/assets/js/31.e026dfd1.js"><link rel="prefetch" href="/assets/js/32.0aec1f2e.js"><link rel="prefetch" href="/assets/js/33.9dd3d5d8.js"><link rel="prefetch" href="/assets/js/4.0a2f3beb.js"><link rel="prefetch" href="/assets/js/5.a33a2f42.js"><link rel="prefetch" href="/assets/js/6.f0091315.js"><link rel="prefetch" href="/assets/js/7.53d7b1d5.js"><link rel="prefetch" href="/assets/js/8.bae4ccb5.js"><link rel="prefetch" href="/assets/js/9.280a7124.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2f7dcf9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Introduction à Symfony</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cours/" class="nav-link router-link-active">
  Cours
</a></div><div class="nav-item"><a href="/projets/" class="nav-link">
  Projets
</a></div><div class="nav-item"><a href="/ressources/" class="nav-link">
  Ressources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cours/" class="nav-link router-link-active">
  Cours
</a></div><div class="nav-item"><a href="/projets/" class="nav-link">
  Projets
</a></div><div class="nav-item"><a href="/ressources/" class="nav-link">
  Ressources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cours/" aria-current="page" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/#qu-est-ce-qu-un-framework" class="sidebar-link">Qu'est ce qu'un framework ?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/#definition" class="sidebar-link">Définition</a></li><li class="sidebar-sub-header"><a href="/cours/#objectifs-d-un-framework" class="sidebar-link">Objectifs d'un framework</a></li><li class="sidebar-sub-header"><a href="/cours/#avantages-et-inconvenients-d-un-framework" class="sidebar-link">Avantages et inconvénients d'un framework</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/#decouvrir-symfony" class="sidebar-link">Découvrir Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/#presentation-generale" class="sidebar-link">Présentation générale</a></li><li class="sidebar-sub-header"><a href="/cours/#pourquoi-symfony-et-pas-un-autre" class="sidebar-link">Pourquoi Symfony et pas un autre ?</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/installation.html" class="sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/installation.html#prerequis" class="sidebar-link">Prérequis</a></li><li class="sidebar-sub-header"><a href="/cours/installation.html#telecharger-et-installer-symfony" class="sidebar-link">Télécharger et installer Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/installation.html#parenthese-sur-composer" class="sidebar-link">Parenthèse sur Composer</a></li><li class="sidebar-sub-header"><a href="/cours/installation.html#premier-projet-symfony" class="sidebar-link">Premier projet Symfony</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/installation.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/structure.html" class="sidebar-link">Structure du projet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/structure.html#la-console-de-symfony" class="sidebar-link">La console de Symfony</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#la-partie-publique" class="sidebar-link">La partie publique</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#le-code-source-php" class="sidebar-link">Le code source PHP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/structure.html#un-point-sur-le-kernel" class="sidebar-link">Un point sur le Kernel</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-templates" class="sidebar-link">Les templates</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-fichiers-temporaires" class="sidebar-link">Les fichiers temporaires</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/structure.html#le-dossier-var-cache" class="sidebar-link">Le dossier /var/cache/</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#le-dossier-var-log" class="sidebar-link">Le dossier /var/log/</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-dependances" class="sidebar-link">Les dépendances</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-variables-d-environnement" class="sidebar-link">Les variables d'environnement</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#la-configuration-de-composer" class="sidebar-link">La configuration de Composer</a></li></ul></li><li><a href="/cours/bundle-et-flex.html" class="sidebar-link">Bundles, Flex et auto-configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/bundle-et-flex.html#qu-est-ce-qu-un-bundle" class="sidebar-link">Qu'est ce qu'un bundle ?</a></li><li class="sidebar-sub-header"><a href="/cours/bundle-et-flex.html#symfony-et-flex" class="sidebar-link">Symfony et Flex</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/bundle-et-flex.html#nettoyage-du-projet" class="sidebar-link">Nettoyage du projet</a></li></ul></li></ul></li><li><a href="/cours/controleur-et-routing.html" class="sidebar-link">Contrôleur et Routing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#requete-et-reponse" class="sidebar-link">Requête et réponse</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#routing" class="sidebar-link">Routing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#fonctionnement" class="sidebar-link">Fonctionnement</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#configuration-d-une-route" class="sidebar-link">Configuration d'une route</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#les-parametres-d-une-route" class="sidebar-link">Les paramètres d'une route</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#debug-des-routes" class="sidebar-link">Debug des routes</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#controleur" class="sidebar-link">Contrôleur</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#generer-des-urls" class="sidebar-link">Générer des URLs</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#manipuler-l-objet-request" class="sidebar-link">Manipuler l'objet Request</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/twig.html" class="sidebar-link">Le moteur de template Twig</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/twig.html#les-templates-dans-symfony" class="sidebar-link">Les templates dans Symfony</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#la-syntaxe-de-twig" class="sidebar-link">La syntaxe de Twig</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/twig.html#comparaison-entre-php-et-twig" class="sidebar-link">Comparaison entre PHP et Twig</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#les-filtres" class="sidebar-link">Les filtres</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/twig.html#integration-dans-symfony" class="sidebar-link">Intégration dans Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/twig.html#generation-de-lien" class="sidebar-link">Génération de lien</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#gestion-des-assets" class="sidebar-link">Gestion des assets</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/twig.html#heritage-de-templates" class="sidebar-link">Héritage de templates</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/formulaire.html" class="sidebar-link">Formulaires</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/formulaire.html#creation-d-un-objet-contact" class="sidebar-link">Création d'un objet Contact</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#creation-d-une-classe-de-formulaire" class="sidebar-link">Création d'une classe de formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#implementation-du-formulaire" class="sidebar-link">Implementation du formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#affichage-du-formulaire" class="sidebar-link">Affichage du formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#protection-csrf" class="sidebar-link">Protection CSRF</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#validation-du-formulaire" class="sidebar-link">Validation du formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#les-messages-flash" class="sidebar-link">Les messages flash</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/injection-dependances.html" class="sidebar-link">L'injection de dépendances</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#definition" class="sidebar-link">Définition</a></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#le-conteneur-d-injection-de-dependances" class="sidebar-link">Le conteneur d'injection de dépendances</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#les-factories" class="sidebar-link">Les factories</a></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#la-configuration" class="sidebar-link">La configuration</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#l-autowiring" class="sidebar-link">L'Autowiring</a></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/service.html" class="sidebar-link">Les services avec Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#les-services" class="sidebar-link">Les services</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#creer-un-service" class="sidebar-link">Créer un service</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#utiliser-un-service" class="sidebar-link">Utiliser un service</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#lister-les-services-graces-a-la-console" class="sidebar-link">Lister les services grâces à la console</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#configuration" class="sidebar-link">Configuration</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/service.html#les-parametres" class="sidebar-link">Les paramètres</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#utilite-et-definition" class="sidebar-link">Utilité et définition</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#utilisation-dans-la-configuration" class="sidebar-link">Utilisation dans la configuration</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#utilisation-dans-un-service" class="sidebar-link">Utilisation dans un service</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/service.html#exemple-utilisation-du-mailer" class="sidebar-link">Exemple : Utilisation du Mailer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#l-envoi-d-un-email" class="sidebar-link">L'envoi d'un email</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#analyser-ses-envois" class="sidebar-link">Analyser ses envois</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/service.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/entities.html" class="sidebar-link">Les entités Doctrine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/entities.html#creer-une-entite" class="sidebar-link">Créer une entité</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#gerer-l-etat-de-la-base-de-donnees" class="sidebar-link">Gérer l'état de la base de données</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/entities.html#les-migrations" class="sidebar-link">Les migrations</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/entities.html#interagir-avec-doctrine" class="sidebar-link">Interagir avec Doctrine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/entities.html#insertion" class="sidebar-link">Insertion</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#modification" class="sidebar-link">Modification</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#suppression" class="sidebar-link">Suppression</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/entities.html#des-donnees-de-developpement" class="sidebar-link">Des données de développement</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/relations.html" class="sidebar-link">Relations entre entités</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/relations.html#quelques-notions-importantes" class="sidebar-link">Quelques notions importantes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/relations.html#notion-de-proprietaire-et-d-inverse" class="sidebar-link">Notion de propriétaire et d'inverse</a></li><li class="sidebar-sub-header"><a href="/cours/relations.html#notion-d-unidirectionnalite-et-de-bidirectionnalite" class="sidebar-link">Notion d'unidirectionnalité et de bidirectionnalité</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/relations.html#les-types-de-relations" class="sidebar-link">Les types de relations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/relations.html#relation-onetoone" class="sidebar-link">Relation OneToOne</a></li><li class="sidebar-sub-header"><a href="/cours/relations.html#relation-manytoone" class="sidebar-link">Relation ManyToOne</a></li><li class="sidebar-sub-header"><a href="/cours/relations.html#relation-manytomany" class="sidebar-link">Relation ManyToMany</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/relations.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/repositories.html" class="sidebar-link">Les repositories</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#les-methodes-de-construction-de-query" class="sidebar-link">Les méthodes de construction de query</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#doctrine-query-language-dql" class="sidebar-link">Doctrine Query Language (DQL)</a></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#querybuilder" class="sidebar-link">QueryBuilder</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#recuperer-ses-entites" class="sidebar-link">Récupérer ses entités</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#les-methodes-de-base" class="sidebar-link">Les méthodes de base</a></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#les-methodes-magiques" class="sidebar-link">Les méthodes magiques</a></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#vos-propres-methodes" class="sidebar-link">Vos propres méthodes</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#aides" class="sidebar-link">Aides</a></li></ul></li></ul></li><li><a href="/cours/event-dispatcher.html" class="sidebar-link">L'event dispatcher</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#le-principe" class="sidebar-link">Le principe</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#envoyer-des-evenements" class="sidebar-link">Envoyer des événements</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#ecouter-les-evenements" class="sidebar-link">Écouter les événements</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/mise-en-ligne.html" class="sidebar-link">La mise en ligne</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#personnaliser-les-pages-d-erreur" class="sidebar-link">Personnaliser les pages d'erreur</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#verifier-son-site-symfony" class="sidebar-link">Vérifier son site Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#tester-son-application" class="sidebar-link">Tester son application</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#verifier-la-qualite-du-code" class="sidebar-link">Vérifier la qualité du code</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#deployer-son-site-symfony-en-ligne" class="sidebar-link">Déployer son site Symfony en ligne</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#sans-acces-ssh" class="sidebar-link">Sans accès SSH</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#avec-acces-ssh" class="sidebar-link">Avec accès SSH</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#explications-en-details" class="sidebar-link">Explications en détails</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/plus-loin.html" class="sidebar-link">Pour aller plus loin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#sur-symfony" class="sidebar-link">Sur Symfony</a></li><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#s-ameliorer" class="sidebar-link">S'améliorer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#pourquoi" class="sidebar-link">Pourquoi</a></li><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#comment" class="sidebar-link">Comment</a></li><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#comment-apprendre" class="sidebar-link">Comment apprendre ?</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="authentification-et-autorisations"><a href="#authentification-et-autorisations" class="header-anchor">#</a> Authentification et autorisations</h1> <p>Symfony propose un mécanisme très complet permettant de gérer l'<strong>authentification</strong> et les <strong>autorisations</strong>. Dans ce chapitre, nous allons mettre en place une système d'authentification à l'aide d'un formulaire de connexion et évoquer les bases des autorisations.</p> <p>Ces deux points cruciaux sont gérées ensemble à travers les packages de <strong>Security</strong>, composées de plusieurs <strong>composants</strong> et d'un <strong>bundle</strong>. Encore une fois, ce bundle permet l'<strong>intégration</strong> des composants dans le framework.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Permet d'installer le bundle grâce à son alias de Symfony Flex</span>
<span class="token function">composer</span> require security
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Flex va également de nouveau nous créer un fichier de configuration pour ce bundle <strong>config/packages/security.yaml</strong>.</p> <h2 id="authentification"><a href="#authentification" class="header-anchor">#</a> Authentification</h2> <h3 id="la-classe-user"><a href="#la-classe-user" class="header-anchor">#</a> La classe User</h3> <p>Le premier point qu'il nous faut régler afin de mettre en place notre système d'<strong>authentification</strong> est la création d'une classe implémentant l'interface <strong>Symfony/Component/Security/Core/User/UserInterface</strong>. Cette classe sera nécessaire peu importe le type d'authentification qu'utilisera l'application (en base de données, via OAuth avec Facebook, sur un LDAP, ...).</p> <p>Encore une fois, le <strong>MakerBundle</strong> va nous aider à mettre en place rapidement cette classe avec une commande interactive !</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>php bin/console make:user
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Voici les réponses que nous allons fournir aux différentes questions de la commande :</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>The name of the security user class <span class="token punctuation">(</span>e.g. User<span class="token punctuation">)</span> <span class="token punctuation">[</span>User<span class="token punctuation">]</span>:
<span class="token operator">&gt;</span> User

Do you want to store user data <span class="token keyword">in</span> the database <span class="token punctuation">(</span>via Doctrine<span class="token punctuation">)</span>? <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span> <span class="token punctuation">[</span>yes<span class="token punctuation">]</span>:
<span class="token operator">&gt;</span> <span class="token function">yes</span>

Enter a property name that will be the unique <span class="token string">&quot;display&quot;</span> name <span class="token keyword">for</span> the user <span class="token punctuation">(</span>e.g.
email, username, uuid <span class="token punctuation">[</span>email<span class="token punctuation">]</span>
<span class="token operator">&gt;</span> username

Does this app need to hash/check user passwords? <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span> <span class="token punctuation">[</span>yes<span class="token punctuation">]</span>:
<span class="token operator">&gt;</span> <span class="token function">yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Nous avons donc créer une entité Doctrine <strong>App\Entity\User</strong> qui se connectera avec un nom d'utilisateur et l'application sera chargée de gérer le hachage des mots de passe.</p> <p>La commande a donc :</p> <ol><li>Créée une entité User et son repository.</li> <li>Implémentée l'interface correctement en fonction de nos réponses.</li> <li>Modifiée le fichier de configuration <strong>security.yaml</strong>.</li></ol> <p>Voici la configuration qui a changé :</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">encoders</span><span class="token punctuation">:</span>
        <span class="token key atrule">App\Entity\User</span><span class="token punctuation">:</span>
            <span class="token key atrule">algorithm</span><span class="token punctuation">:</span> auto

    <span class="token key atrule">providers</span><span class="token punctuation">:</span>
        <span class="token key atrule">app_user_provider</span><span class="token punctuation">:</span>
            <span class="token key atrule">entity</span><span class="token punctuation">:</span>
                <span class="token key atrule">class</span><span class="token punctuation">:</span> App\Entity\User
                <span class="token key atrule">property</span><span class="token punctuation">:</span> username
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>La clé <strong>encoders</strong> permet de préciser que pour notre classe <strong>App\Entity\User</strong>, les mots de passe seront encodés avec l'algorithme <strong>auto</strong>. Ce dernier correspond en faite à la constante <strong>PASSWORD_DEFAULT</strong> de la méthode PHP <a href="https://www.php.net/manual/fr/function.password-hash.php" target="_blank" rel="noopener noreferrer">password_hash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. En ce moment, c'est <strong>bcrypt</strong> qui est considéré comme le meilleur algorithme pour les mots de passe pour <strong>PHP</strong>.</p> <p>La clé <strong>providers</strong> configure les différents <strong>User Providers</strong>.</p> <h3 id="les-user-providers"><a href="#les-user-providers" class="header-anchor">#</a> Les User Providers</h3> <p>Pour indiquer à l'application comment trouver nos utilisateurs, elle aura besoin de savoir comment si prendre. C'est le but du <strong>User Provider</strong> qui a été configuré précédemment.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Une fois connecté, l'utilisateur est chargé à chaque nouvelle requête.</p></div> <p>Puisque notre classe <strong>User</strong> est une entité <strong>Doctrine</strong>, nous allons utiliser l'<a href="https://symfony.com/doc/current/security/user_provider.html#entity-user-provider" target="_blank" rel="noopener noreferrer">Entity User Provider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Ce <strong>provider</strong> utilisera lui-même <strong>Doctrine</strong> pour faire une requête en base de données afin d'y chercher notre utilisateur.</p> <p>Il existe d'autre <strong>providers</strong> mis à disposition dont nous pouvons citer par exemple :</p> <ul><li>Le <strong>MemoryUserProvider</strong> qui sert principalement pour le développement et les tests</li> <li>Le <strong>LdapUserProvider</strong> qui permet de se connecter avec un serveur <strong>LDAP</strong></li></ul> <p>Vous pouvez également créer vos propres provider en implémentant l'interface <strong>Symfony\Component\Security\Core\User\UserProviderInterface</strong>.</p> <h3 id="les-firewalls"><a href="#les-firewalls" class="header-anchor">#</a> Les Firewalls</h3> <p>La configuration <strong>la plus importante</strong> de notre système de connexion se trouve sous la clé <strong>firewalls</strong>.</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
    <span class="token key atrule">firewalls</span><span class="token punctuation">:</span>
        <span class="token key atrule">dev</span><span class="token punctuation">:</span>
            <span class="token key atrule">pattern</span><span class="token punctuation">:</span> ^/(_(profiler<span class="token punctuation">|</span>wdt)<span class="token punctuation">|</span>css<span class="token punctuation">|</span>images<span class="token punctuation">|</span>js)/
            <span class="token key atrule">security</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
        <span class="token key atrule">main</span><span class="token punctuation">:</span>
            <span class="token key atrule">anonymous</span><span class="token punctuation">:</span> lazy
            <span class="token key atrule">lazy</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">provider</span><span class="token punctuation">:</span> app_user_provider
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Il y a actuellement <strong>deux firewalls</strong> définis par défaut :</p> <ul><li>Le firewall <strong>dev</strong> est seulement ici pour empêcher de bloquer accidentellement les outils de debug de Symfony.</li> <li>Le firewall <strong>main</strong>, qui correspond actuellement à toutes les URLs de notre application (car il n'y pas de clé <em>pattern</em> définie).</li></ul> <p>En effet, comme pour les routes, le <strong>premier firewall</strong> qui correspond à l'URL de la requête courante sera utilisé.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>La plupart du temps, la définition d'<strong>un seul firewall</strong> est nécessaire pour gérer tout le système d'authentification de notre application. C'est considéré comme une bonne pratique dans limiter le nombre.</p></div> <p>Le fait que le <strong>firewall main</strong> englobe toutes nos URLs ne veut pas dire pour autant qu'il faut absolument être connecté pour pouvoir accéder à notre contenu. La clé de configuration <strong>anonymous</strong> signifie que ce firewall accepte également les <strong>utilisateurs anonymes</strong>. D'ailleurs, si vous jetez un coup d'oeil à la <strong>debug bar</strong>, vous pourrez voir que actuellement nous utilisons un utilisateur anonyme :</p> <p><img src="/img/anonymous.png" alt="Debug bar anonymous user"></p> <p>La <strong>debug bar</strong> nous définie comme authentifier car notre firewall <strong>main</strong> correspond à l'URL de notre requête. Authentifié, certes, mais avec un utilisateur <strong>anonyme</strong> !</p> <h3 id="authentication-providers"><a href="#authentication-providers" class="header-anchor">#</a> Authentication Providers</h3> <p>Afin que nous puissions nous connecter, il va falloir configurer notre firewall <strong>main</strong> avec un <strong>Authentication Provider</strong>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Notez qu'il est tout à fait possible d'avoir plusieurs <strong>Authentication Providers</strong> pour un seul firewall.</p></div> <p>Encore une fois, Symfony nous en fournit déjà quelqu'uns pour nous faciliter la tâche, dont les suivants :</p> <ul><li>form_login</li> <li>json_login</li> <li>http_basics</li></ul> <p>Ceci sont très pratiques pour configurer rapidement un système de connexion mais ils ont l'inconvenient d'être plus dûrs à personnaliser. C'est pourquoi, il est conseillé d'utiliser un système plus complet, à savoir <strong>Guard</strong>.</p> <h3 id="guard-authenticator"><a href="#guard-authenticator" class="header-anchor">#</a> Guard authenticator</h3> <p>L'avantage de <strong>Guard</strong> est qu'il nous donne <strong>plus de contrôle</strong> sur tout le processus de connexion. Le <strong>MakerBundle</strong> va nous permettre de rapidement générer les bases de notre système de connexion basé sur <strong>Guard</strong>.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>php bin/console make:auth
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>What style of authentication <span class="token keyword">do</span> you want? <span class="token punctuation">[</span>Empty authenticator<span class="token punctuation">]</span>:
 <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> Empty authenticator
 <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> Login form authenticator
<span class="token operator">&gt;</span> <span class="token number">1</span>

The class name of the authenticator to create <span class="token punctuation">(</span>e.g. AppCustomAuthenticator<span class="token punctuation">)</span>:
<span class="token operator">&gt;</span> LoginFormAuthenticator

Choose a name <span class="token keyword">for</span> the controller class <span class="token punctuation">(</span>e.g. SecurityController<span class="token punctuation">)</span> <span class="token punctuation">[</span>SecurityController<span class="token punctuation">]</span>:
<span class="token operator">&gt;</span> SecurityController

Do you want to generate a <span class="token string">'/logout'</span> URL? <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span> <span class="token punctuation">[</span>yes<span class="token punctuation">]</span>:
<span class="token operator">&gt;</span> <span class="token function">yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Cette commande a fait beaucoup pour nous :</p> <ol><li>Créée notre classe <strong>Guard</strong> <strong>App\Security\LoginFormAuthenticator</strong> qui contient tout le processus de connexion</li> <li>Générée un <strong>SecurityController</strong> avec une action de <strong>login</strong> et une de <strong>logout</strong></li> <li>Créée un template par défaut de login dans <strong>security/login.html.twig</strong></li> <li>Complétée la configuration de notre firewall pour utiliser notre classe <strong>Guard</strong> et setup l'action de déconnexion</li></ol> <p>N'hésitez pas à modifier le code ainsi généré afin de vous l'approprier. C'est votre code à présent !</p> <h2 id="autorisation"><a href="#autorisation" class="header-anchor">#</a> Autorisation</h2> <p>Il y a des actions que seuls les utilisateurs connectés peuvent réaliser. Cependant, tous nos utilisateurs ne sont pas forcement égaux en droits (dans notre application, bien sûr).</p> <p>Pour gérer ces différences d'autorisations, Symfony nous proposent plusieurs mécanismes, dont le premier est l'introduction de rôles pour les utilisateurs.</p> <h3 id="les-roles"><a href="#les-roles" class="header-anchor">#</a> Les roles</h3> <p>Si vous regardez votre classe User, vous voyez qu'elle dispose déjà d'une méthode <strong>getRoles()</strong> qui lui vient de l'interface <strong>UserInterface</strong>.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// App\Entity\User</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>
<span class="token punctuation">{</span>
    <span class="token variable">$roles</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">roles</span><span class="token punctuation">;</span>
    <span class="token comment">// guarantee every user at least has ROLE_USER</span>
    <span class="token variable">$roles</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'ROLE_USER'</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">array_unique</span><span class="token punctuation">(</span><span class="token variable">$roles</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Comme vous le voyez, tous nos <strong>User</strong> dispose du rôle <strong>ROLE_USER</strong> par défaut.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Les rôles doivent toujours commencer par la chaîne de caractères <strong>&quot;ROLE_&quot;</strong> mais vous pouvez <strong>n'importe quel rôle</strong> qui a un sens dans votre application.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Il est également possible de définir une <strong>hiérarchie de rôles</strong>. Par exemple, pour que tous les utilisateurs ayant le ROLE_ADMIN possède également le ROLE_MODERATOR.</p></div> <p>Ces rôles nous seront utiles afin de limiter les différentes actions des utilisateurs.</p> <h4 id="les-roles-speciaux"><a href="#les-roles-speciaux" class="header-anchor">#</a> Les rôles spéciaux</h4> <p>Il existe trois rôles un peu particuliers car ils ne correspondent pas directement à des rôles d'utilisateurs :</p> <ul><li>Le rôle <strong>IS_AUTHENTICATED_ANONYMOUSLY</strong> est attribué à <strong>tous les utilisateurs</strong>, qu'ils soient connectés ou non.</li> <li>Le rôle <strong>IS_AUTHENTICATED_REMEMBERED</strong> est attribué à <strong>tous les utilisateurs connectés</strong>, qu'ils utilisent la fonctionnalité de <a href="https://symfony.com/doc/current/security/remember_me.html" target="_blank" rel="noopener noreferrer">remember_me<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ou non.</li> <li>Le rôle <strong>IS_AUTHENTICATED_FULLY</strong> est attribué à <strong>tous les utilisateurs connectés</strong> qui ne se sont pas connectés automatiquement avec la fonctionnalité de <em>remember_me</em>.</li></ul> <h3 id="recuperer-l-utilisateur-connecte"><a href="#recuperer-l-utilisateur-connecte" class="header-anchor">#</a> Récupérer l'utilisateur connecté</h3> <p>Maintenant que nos utilisateurs sont capables de se connecter, on va avoir besoin de les récupérer pour interagir avec eux. Pour cela nous disposons de plusieurs méthodes en fonction du contexte :</p> <h4 id="depuis-un-controleur"><a href="#depuis-un-controleur" class="header-anchor">#</a> Depuis un contrôleur</h4> <p>Si notre contrôleur étant l'<strong>AbstractController</strong>, nous pouvons par exemple faire ceci :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$currentUser</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$user</span> <span class="token keyword">instanceof</span> <span class="token class-name">User</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">createAccessDeniedException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>La méthode <strong>getUser()</strong> nous retourne l'utilisateur courant. Si ce n'est pas une instance de <strong>User</strong>, nous pouvons envoyer une exception qui limitera l'accès.</p> <h4 id="depuis-un-service"><a href="#depuis-un-service" class="header-anchor">#</a> Depuis un service</h4> <p>La méthode précédente utilise en fait un service pour récupérer l'utilisateur que Symfony à pris soin d'injecter pour nous. Mais dans un de nos service, nous avons besoin de l'injecter nous même.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Security</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">MonService</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$security</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Security</span> <span class="token variable">$security</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">security</span> <span class="token operator">=</span> <span class="token variable">$security</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">security</span><span class="token operator">-&gt;</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="depuis-un-template-twig"><a href="#depuis-un-template-twig" class="header-anchor">#</a> Depuis un template Twig</h4> <p>Si vous vous rappelez le chapitre sur <strong>Twig</strong>, nous avions vu qu'il existait un objet à disposition un peu particulier dans nos templates : la variable <strong>app</strong>. En effet, cette variable nous permet de récupérer directement notre utilisateur dans nos templates Twig :</p> <div class="language-twig line-numbers-mode"><pre class="language-twig"><code><span class="token twig language-twig"><span class="token comment">{# null ou une instance de notre classe User #}</span></span>
<span class="token twig language-twig"><span class="token delimiter punctuation">{{</span> dump<span class="token punctuation">(</span>app<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="limiter-l-acces-a-une-partie-de-notre-application"><a href="#limiter-l-acces-a-une-partie-de-notre-application" class="header-anchor">#</a> Limiter l'accès à une partie de notre application</h3> <p>Il reste une dernière clé dont nous n'avons parlée dans notre ficher de configuration <strong>security.yaml</strong>. Il s'agit de la clé <strong>access_control</strong>.</p> <p>Cette configuration permet de limiter l'accès à toute une partie de notre application.</p> <p>Comme pour le firewall :</p> <ul><li>Une règle <strong>access_control</strong> regarde si le pattern de l'URL de la requête correspond</li> <li>La premiere règle d'<strong>access_control</strong> qui correspond sera utilisé</li></ul> <p>Par exemple :</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
    <span class="token key atrule">access_control</span><span class="token punctuation">:</span>
        <span class="token comment"># On prend soin d'autoriser l'accès au login</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> ^/admin/login<span class="token punctuation">,</span> <span class="token key atrule">roles</span><span class="token punctuation">:</span> IS_AUTHENTICATED_ANONYMOUSLY <span class="token punctuation">}</span>
        <span class="token comment"># Tous les URLs commençant par /admin seront bloquées pour les utilisateurs n'ayant pas le rôle ROLE_ADMIN</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> ^/admin<span class="token punctuation">,</span> <span class="token key atrule">roles</span><span class="token punctuation">:</span> ROLE_ADMIN <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Une erreur courante consiste à autoriser l'accès à la connexion seulement aux utilisateurs connectés. Les utilisateurs anonymes ne peuvent donc plus se connecter. Garder ça à l'esprit !</p></div> <h3 id="verifiez-les-droits"><a href="#verifiez-les-droits" class="header-anchor">#</a> Vérifiez les droits</h3> <p>Bien que nous savons maintenant comment empêcher un simple utilisateur d'accèder à notre back-office, nous pourrions avoir besoin d'avoir plus de contrôle sur ce qu'un modérateur pourrait y faire, par exemple.</p> <p>Le service <strong>Symfony\Component\Security\Core\Authorization\AuthorizationCheckerInterface</strong> va nous aider dans ce but.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Authorization</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name-definition class-name">AuthorizationCheckerInterface</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">isGranted</span><span class="token punctuation">(</span><span class="token variable">$attribute</span><span class="token punctuation">,</span> <span class="token variable">$subject</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Cette interface contient seulement une méthode <strong>isGranted()</strong> qui prend principalement un paramètre <strong>attribut</strong>. Bien que cette <strong>attribut</strong> puisse être de n'importe quel type, nous allons nous contenter dans ce cours d'y insérer <strong>les rôles</strong> que nous voulons vérifier pour l'<strong>utilisateur courant</strong>. Ainsi, nous pourrions faire dans un contrôleur :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Cette méthode est un raccourci fournit par l'AbstractController</span>
    <span class="token comment">// qui utilise en fait le service d'AuthorizationChecker</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">isGranted</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ROLE_ADMIN'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">createAccessDeniedException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Ou alors plus court avec un autre helper de contrôleur</span>
    <span class="token comment">// qui enverra l'exception dans le cas échéant</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">denyAccessUnlessGranted</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ROLE_ADMIN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>De la même façon, dans nos templates <strong>Twig</strong> afin d'afficher conditionnellement du HTML à nos utilisateurs :</p> <div class="language-twig line-numbers-mode"><pre class="language-twig"><code><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">if</span> is_granted<span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>IS_AUTHENTICATED_REMEMBERED<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token delimiter punctuation">%}</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Se déconnecter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">endif</span> <span class="token delimiter punctuation">%}</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="a-vous-de-jouer"><a href="#a-vous-de-jouer" class="header-anchor">#</a> A vous de jouer</h2> <ol><li>Créez votre entité User grâce à la commande <strong>make:user</strong> et liez y vos <strong>Comment</strong>.</li> <li>Complétez vos <strong>fixtures</strong> pour y charger quelques utilisateurs. Prenez soit d'encoder le mot de passe grâce à l'injection du service <strong>Symfony\Component\Security\Core\Encoder\UserPasswordEncoderInterface</strong>.</li> <li>Modifiez la <strong>page de détail d'un produit</strong> pour que le nom de l'utilisateur ayant commenté l'article y apparaisse.</li> <li>Mettez en place le <strong>système de connexion</strong>.</li> <li>Intégrez les <a href="/projects/shoefony-template-login.zip">templates fournis</a> dans votre système de connexion.</li> <li>Autorisez l'ajout de commentaires seulement pour les <strong>utilisateurs connectés</strong> (dans le template et le contrôleur).</li> <li>Créez un nouveau contrôleur <strong>AccountController</strong> dont toutes les URLs commenceront par <strong>/mon-compte</strong> et créez y deux actions basiques.</li> <li>Limitez l'accès à toutes les URLS commençant par <strong>/mon-compte</strong> pour que seuls les utilisateurs connectés puissent y avoir accès.</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f5ffb287.js" defer></script><script src="/assets/js/2.85d345eb.js" defer></script><script src="/assets/js/20.2dd543f1.js" defer></script>
  </body>
</html>
