<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Les entités Doctrine | Introduction à Symfony</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Licence Professionnelle SIL - Web et Mobile pour le Commerce Électronique">
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="preload" href="/assets/css/0.styles.e2f7dcf9.css" as="style"><link rel="preload" href="/assets/js/app.f5ffb287.js" as="script"><link rel="preload" href="/assets/js/2.85d345eb.js" as="script"><link rel="preload" href="/assets/js/11.08c438c2.js" as="script"><link rel="prefetch" href="/assets/js/10.457dba52.js"><link rel="prefetch" href="/assets/js/12.cbc1776f.js"><link rel="prefetch" href="/assets/js/13.418be2c7.js"><link rel="prefetch" href="/assets/js/14.d52a0530.js"><link rel="prefetch" href="/assets/js/15.21450e21.js"><link rel="prefetch" href="/assets/js/16.872dd91c.js"><link rel="prefetch" href="/assets/js/17.b3e69a97.js"><link rel="prefetch" href="/assets/js/18.62e92111.js"><link rel="prefetch" href="/assets/js/19.e575b9c0.js"><link rel="prefetch" href="/assets/js/20.2dd543f1.js"><link rel="prefetch" href="/assets/js/21.207e0e56.js"><link rel="prefetch" href="/assets/js/22.d2fc0852.js"><link rel="prefetch" href="/assets/js/23.d71aaa5c.js"><link rel="prefetch" href="/assets/js/24.4a856b70.js"><link rel="prefetch" href="/assets/js/25.886f50e9.js"><link rel="prefetch" href="/assets/js/26.7345d31d.js"><link rel="prefetch" href="/assets/js/27.98540e6e.js"><link rel="prefetch" href="/assets/js/28.6a30ed2d.js"><link rel="prefetch" href="/assets/js/29.932c0b60.js"><link rel="prefetch" href="/assets/js/3.0cf10e4b.js"><link rel="prefetch" href="/assets/js/30.aa92a368.js"><link rel="prefetch" href="/assets/js/31.e026dfd1.js"><link rel="prefetch" href="/assets/js/32.0aec1f2e.js"><link rel="prefetch" href="/assets/js/33.9dd3d5d8.js"><link rel="prefetch" href="/assets/js/4.0a2f3beb.js"><link rel="prefetch" href="/assets/js/5.a33a2f42.js"><link rel="prefetch" href="/assets/js/6.f0091315.js"><link rel="prefetch" href="/assets/js/7.53d7b1d5.js"><link rel="prefetch" href="/assets/js/8.bae4ccb5.js"><link rel="prefetch" href="/assets/js/9.280a7124.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2f7dcf9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Introduction à Symfony</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cours/" class="nav-link router-link-active">
  Cours
</a></div><div class="nav-item"><a href="/projets/" class="nav-link">
  Projets
</a></div><div class="nav-item"><a href="/ressources/" class="nav-link">
  Ressources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cours/" class="nav-link router-link-active">
  Cours
</a></div><div class="nav-item"><a href="/projets/" class="nav-link">
  Projets
</a></div><div class="nav-item"><a href="/ressources/" class="nav-link">
  Ressources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cours/" aria-current="page" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/#qu-est-ce-qu-un-framework" class="sidebar-link">Qu'est ce qu'un framework ?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/#definition" class="sidebar-link">Définition</a></li><li class="sidebar-sub-header"><a href="/cours/#objectifs-d-un-framework" class="sidebar-link">Objectifs d'un framework</a></li><li class="sidebar-sub-header"><a href="/cours/#avantages-et-inconvenients-d-un-framework" class="sidebar-link">Avantages et inconvénients d'un framework</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/#decouvrir-symfony" class="sidebar-link">Découvrir Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/#presentation-generale" class="sidebar-link">Présentation générale</a></li><li class="sidebar-sub-header"><a href="/cours/#pourquoi-symfony-et-pas-un-autre" class="sidebar-link">Pourquoi Symfony et pas un autre ?</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/installation.html" class="sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/installation.html#prerequis" class="sidebar-link">Prérequis</a></li><li class="sidebar-sub-header"><a href="/cours/installation.html#telecharger-et-installer-symfony" class="sidebar-link">Télécharger et installer Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/installation.html#parenthese-sur-composer" class="sidebar-link">Parenthèse sur Composer</a></li><li class="sidebar-sub-header"><a href="/cours/installation.html#premier-projet-symfony" class="sidebar-link">Premier projet Symfony</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/installation.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/structure.html" class="sidebar-link">Structure du projet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/structure.html#la-console-de-symfony" class="sidebar-link">La console de Symfony</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#la-partie-publique" class="sidebar-link">La partie publique</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#le-code-source-php" class="sidebar-link">Le code source PHP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/structure.html#un-point-sur-le-kernel" class="sidebar-link">Un point sur le Kernel</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-templates" class="sidebar-link">Les templates</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-fichiers-temporaires" class="sidebar-link">Les fichiers temporaires</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/structure.html#le-dossier-var-cache" class="sidebar-link">Le dossier /var/cache/</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#le-dossier-var-log" class="sidebar-link">Le dossier /var/log/</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-dependances" class="sidebar-link">Les dépendances</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-variables-d-environnement" class="sidebar-link">Les variables d'environnement</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#la-configuration-de-composer" class="sidebar-link">La configuration de Composer</a></li></ul></li><li><a href="/cours/bundle-et-flex.html" class="sidebar-link">Bundles, Flex et auto-configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/bundle-et-flex.html#qu-est-ce-qu-un-bundle" class="sidebar-link">Qu'est ce qu'un bundle ?</a></li><li class="sidebar-sub-header"><a href="/cours/bundle-et-flex.html#symfony-et-flex" class="sidebar-link">Symfony et Flex</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/bundle-et-flex.html#nettoyage-du-projet" class="sidebar-link">Nettoyage du projet</a></li></ul></li></ul></li><li><a href="/cours/controleur-et-routing.html" class="sidebar-link">Contrôleur et Routing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#requete-et-reponse" class="sidebar-link">Requête et réponse</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#routing" class="sidebar-link">Routing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#fonctionnement" class="sidebar-link">Fonctionnement</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#configuration-d-une-route" class="sidebar-link">Configuration d'une route</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#les-parametres-d-une-route" class="sidebar-link">Les paramètres d'une route</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#debug-des-routes" class="sidebar-link">Debug des routes</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#controleur" class="sidebar-link">Contrôleur</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#generer-des-urls" class="sidebar-link">Générer des URLs</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#manipuler-l-objet-request" class="sidebar-link">Manipuler l'objet Request</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/twig.html" class="sidebar-link">Le moteur de template Twig</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/twig.html#les-templates-dans-symfony" class="sidebar-link">Les templates dans Symfony</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#la-syntaxe-de-twig" class="sidebar-link">La syntaxe de Twig</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/twig.html#comparaison-entre-php-et-twig" class="sidebar-link">Comparaison entre PHP et Twig</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#les-filtres" class="sidebar-link">Les filtres</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/twig.html#integration-dans-symfony" class="sidebar-link">Intégration dans Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/twig.html#generation-de-lien" class="sidebar-link">Génération de lien</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#gestion-des-assets" class="sidebar-link">Gestion des assets</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/twig.html#heritage-de-templates" class="sidebar-link">Héritage de templates</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/formulaire.html" class="sidebar-link">Formulaires</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/formulaire.html#creation-d-un-objet-contact" class="sidebar-link">Création d'un objet Contact</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#creation-d-une-classe-de-formulaire" class="sidebar-link">Création d'une classe de formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#implementation-du-formulaire" class="sidebar-link">Implementation du formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#affichage-du-formulaire" class="sidebar-link">Affichage du formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#protection-csrf" class="sidebar-link">Protection CSRF</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#validation-du-formulaire" class="sidebar-link">Validation du formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#les-messages-flash" class="sidebar-link">Les messages flash</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/injection-dependances.html" class="sidebar-link">L'injection de dépendances</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#definition" class="sidebar-link">Définition</a></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#le-conteneur-d-injection-de-dependances" class="sidebar-link">Le conteneur d'injection de dépendances</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#les-factories" class="sidebar-link">Les factories</a></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#la-configuration" class="sidebar-link">La configuration</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#l-autowiring" class="sidebar-link">L'Autowiring</a></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/service.html" class="sidebar-link">Les services avec Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#les-services" class="sidebar-link">Les services</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#creer-un-service" class="sidebar-link">Créer un service</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#utiliser-un-service" class="sidebar-link">Utiliser un service</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#lister-les-services-graces-a-la-console" class="sidebar-link">Lister les services grâces à la console</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#configuration" class="sidebar-link">Configuration</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/service.html#les-parametres" class="sidebar-link">Les paramètres</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#utilite-et-definition" class="sidebar-link">Utilité et définition</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#utilisation-dans-la-configuration" class="sidebar-link">Utilisation dans la configuration</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#utilisation-dans-un-service" class="sidebar-link">Utilisation dans un service</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/service.html#exemple-utilisation-du-mailer" class="sidebar-link">Exemple : Utilisation du Mailer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#l-envoi-d-un-email" class="sidebar-link">L'envoi d'un email</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#analyser-ses-envois" class="sidebar-link">Analyser ses envois</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/service.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/entities.html" aria-current="page" class="active sidebar-link">Les entités Doctrine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/entities.html#creer-une-entite" class="sidebar-link">Créer une entité</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#gerer-l-etat-de-la-base-de-donnees" class="sidebar-link">Gérer l'état de la base de données</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/entities.html#les-migrations" class="sidebar-link">Les migrations</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/entities.html#interagir-avec-doctrine" class="sidebar-link">Interagir avec Doctrine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/entities.html#insertion" class="sidebar-link">Insertion</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#modification" class="sidebar-link">Modification</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#suppression" class="sidebar-link">Suppression</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/entities.html#des-donnees-de-developpement" class="sidebar-link">Des données de développement</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/relations.html" class="sidebar-link">Relations entre entités</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/relations.html#quelques-notions-importantes" class="sidebar-link">Quelques notions importantes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/relations.html#notion-de-proprietaire-et-d-inverse" class="sidebar-link">Notion de propriétaire et d'inverse</a></li><li class="sidebar-sub-header"><a href="/cours/relations.html#notion-d-unidirectionnalite-et-de-bidirectionnalite" class="sidebar-link">Notion d'unidirectionnalité et de bidirectionnalité</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/relations.html#les-types-de-relations" class="sidebar-link">Les types de relations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/relations.html#relation-onetoone" class="sidebar-link">Relation OneToOne</a></li><li class="sidebar-sub-header"><a href="/cours/relations.html#relation-manytoone" class="sidebar-link">Relation ManyToOne</a></li><li class="sidebar-sub-header"><a href="/cours/relations.html#relation-manytomany" class="sidebar-link">Relation ManyToMany</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/relations.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/repositories.html" class="sidebar-link">Les repositories</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#les-methodes-de-construction-de-query" class="sidebar-link">Les méthodes de construction de query</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#doctrine-query-language-dql" class="sidebar-link">Doctrine Query Language (DQL)</a></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#querybuilder" class="sidebar-link">QueryBuilder</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#recuperer-ses-entites" class="sidebar-link">Récupérer ses entités</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#les-methodes-de-base" class="sidebar-link">Les méthodes de base</a></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#les-methodes-magiques" class="sidebar-link">Les méthodes magiques</a></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#vos-propres-methodes" class="sidebar-link">Vos propres méthodes</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#aides" class="sidebar-link">Aides</a></li></ul></li></ul></li><li><a href="/cours/event-dispatcher.html" class="sidebar-link">L'event dispatcher</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#le-principe" class="sidebar-link">Le principe</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#envoyer-des-evenements" class="sidebar-link">Envoyer des événements</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#ecouter-les-evenements" class="sidebar-link">Écouter les événements</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/mise-en-ligne.html" class="sidebar-link">La mise en ligne</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#personnaliser-les-pages-d-erreur" class="sidebar-link">Personnaliser les pages d'erreur</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#verifier-son-site-symfony" class="sidebar-link">Vérifier son site Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#tester-son-application" class="sidebar-link">Tester son application</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#verifier-la-qualite-du-code" class="sidebar-link">Vérifier la qualité du code</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#deployer-son-site-symfony-en-ligne" class="sidebar-link">Déployer son site Symfony en ligne</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#sans-acces-ssh" class="sidebar-link">Sans accès SSH</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#avec-acces-ssh" class="sidebar-link">Avec accès SSH</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#explications-en-details" class="sidebar-link">Explications en détails</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/plus-loin.html" class="sidebar-link">Pour aller plus loin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#sur-symfony" class="sidebar-link">Sur Symfony</a></li><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#s-ameliorer" class="sidebar-link">S'améliorer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#pourquoi" class="sidebar-link">Pourquoi</a></li><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#comment" class="sidebar-link">Comment</a></li><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#comment-apprendre" class="sidebar-link">Comment apprendre ?</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="les-entites-doctrine"><a href="#les-entites-doctrine" class="header-anchor">#</a> Les entités Doctrine</h1> <p>L'objectif d'un <strong>Object-Relation Mapper</strong> (ORM) est le suivant : se charger de l'enregistrement de vos données en vous faisant oublier que vous avez une base de données. Comment ? En s'occupant de tout ! Nous n'allons plus écrire de requêtes, ni créer de tables via phpMyAdmin. Dans notre code PHP, nous allons utiliser <strong>Doctrine</strong>, l'ORM par défaut de Symfony.</p> <h2 id="creer-une-entite"><a href="#creer-une-entite" class="header-anchor">#</a> Créer une entité</h2> <p>Une entité, ce que l'ORM va manipuler et enregistrer dans la base de données, n'est rien d'autre qu'un <strong>Plain Old PHP Object</strong> représenté par une classe à créer au sein du répertoire <strong>Entity</strong> de notre projet. Cette entité correspondra à une table de notre base de données.</p> <p>Voici ce à quoi pourrait ressembler l'entité <strong>Product</strong> de notre site :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Store</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Product</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token operator">?</span><span class="token keyword type-hint">int</span> <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword type-declaration">string</span> <span class="token variable">$name</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword type-declaration">string</span> <span class="token variable">$description</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword type-declaration">float</span> <span class="token variable">$price</span><span class="token punctuation">;</span>

    <span class="token comment">// Getters and Setters ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Comme vous pouvez le voir, il n'y a pas grand chose. Un objet, des propriétés, et bien sûr, les getters / setters correspondants.</p> <p>On pourrait en réalité utiliser notre objet dès maintenant, mais l'ORM ne pourrait pour le moment pas enregistrer notre objet en base de données.</p> <p>Nous avions déjà créer une entité dans le chapitre sur les formulaires, <strong>App\Entity\Contact</strong>, mais elles pour l'instant encore toutes les deux incomplètes. En effet, afin que Doctrine puisse savoir quoi faire de nos entités, il va falloir lui indiquer à l'aide d'<strong>attributes</strong>.</p> <p>Pour générer nos entités, nous n'allons pas le faire manuellement, mais nous servir de la commande mis à disposition par le <strong>maker-bundle</strong> :</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>php bin/console make:entity Store<span class="token punctuation">\</span><span class="token punctuation">\</span>Product
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Vous avez remarqué le double anti-slash. Il est probable qu'avec Windows vous ayez une erreur. Si c'est le cas, essayez alors avec un seul anti-slash.</p></div> <p>Lorsqu'on l'exécute, elle nous guide pour générer les différentes propriétés en nous demandant, dans l'ordre et pour chacune :</p> <ul><li><strong>Son nom</strong> : A donner en <strong>camelCase</strong>, bien sûr, et <strong>sans le $</strong>. Dans la base, il est par défaut convertit en <em>snake_case</em></li> <li><strong>Son type Doctrine</strong> : Vous pouvez rentrer &quot;?&quot; pour lister tous les types disponibles</li> <li><strong>Différentes configurations</strong> : Dépend du type choisi</li> <li><strong>Si elle est nullable</strong> : De type booléen pour la configuration de la base de données. Par défaut à <em>false</em></li></ul> <p>Les <strong>Getters</strong> et <strong>Setters</strong> seront également générés pour nous. L'avantage est que, là encore, le code généré suit des conventions, notamment de typage pour nos Getters et Setters.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Pour modifier une entité qui existe déjà, vous pouvez utiliser la même commande, ce qui permettra d'ajouter de nouvelles propriétés.</p></div> <p>Voici ce que ça donne pour notre nouvelle entité <strong>App\Entity\Store\Product</strong> :</p> <div class="language-php line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Store</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Repository<span class="token punctuation">\</span>Store<span class="token punctuation">\</span>ProductRepository</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>DBAL<span class="token punctuation">\</span>Types<span class="token punctuation">\</span>Types</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM<span class="token punctuation">\</span>Mapping</span> <span class="token keyword">as</span> <span class="token constant">ORM</span><span class="token punctuation">;</span>

<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Entity</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">repositoryClass</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">ProductRepository</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Table</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'sto_product'</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Product</span>
<span class="token punctuation">{</span>
    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Id</span></span><span class="token delimiter punctuation">]</span></span>
    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>GeneratedValue</span></span><span class="token delimiter punctuation">]</span></span>
    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span></span><span class="token delimiter punctuation">]</span></span>
    <span class="token keyword">private</span> <span class="token operator">?</span><span class="token keyword type-hint">int</span> <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>

    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">length</span><span class="token punctuation">:</span> <span class="token number">255</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
    <span class="token keyword">private</span> <span class="token keyword type-declaration">string</span> <span class="token variable">$name</span><span class="token punctuation">;</span>

    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">Types</span><span class="token operator">::</span><span class="token constant">TEXT</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
    <span class="token keyword">private</span> <span class="token keyword type-declaration">string</span> <span class="token variable">$description</span><span class="token punctuation">;</span>

    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span></span><span class="token delimiter punctuation">]</span></span>
    <span class="token keyword">private</span> <span class="token keyword type-declaration">float</span> <span class="token variable">$price</span><span class="token punctuation">;</span>

    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span></span><span class="token delimiter punctuation">]</span></span>
    <span class="token keyword">private</span> <span class="token class-name class-name-fully-qualified type-declaration"><span class="token punctuation">\</span>DateTimeImmutable</span> <span class="token variable">$createdAt</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$description</span><span class="token punctuation">,</span> <span class="token keyword type-hint">float</span> <span class="token variable">$price</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">description</span> <span class="token operator">=</span> <span class="token variable">$description</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">price</span> <span class="token operator">=</span> <span class="token variable">$price</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">createdAt</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTimeImmutable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Getters and Setters ...</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>J'ai surligné la <strong>ligne 9</strong> qui n'a pas été ajoutée par la commande. Elle permet de définir le nom que nous voulons pour notre table en base de données, ce qui m'a permit d'ajouter le prefix &quot;sto_&quot; pour celle-ci.</p></div> <p>Grâce à ces <strong>attributes</strong>, que l'on appelle <strong>metadata</strong>, Doctrine dispose de toutes les informations nécessaires pour utiliser notre objet :</p> <ul><li>Créer la table correspondante</li> <li>L'enregistrer</li> <li>Définir un identifiant (id) en auto-incrément</li> <li>Nommer les colonnes</li> <li>etc.</li></ul> <h2 id="gerer-l-etat-de-la-base-de-donnees"><a href="#gerer-l-etat-de-la-base-de-donnees" class="header-anchor">#</a> Gérer l'état de la base de données</h2> <p>Avant de pouvoir utiliser notre entité comme il se doit, on doit d'abord créer la table correspondante dans la base de données. Pour ce faire, il faut commencer par configurer nos accès à la base de données dans le fichier <strong>/.env.local</strong>, en y modifiant la variable <strong>DATABASE_URL</strong>.</p> <p>Et ensuite, encore des <strong>commandes</strong> ! Cette fois-ci, on ne va pas utiliser une commande du maker-bundle, mais une des commandes de Doctrine, car on ne veut pas générer du code mais une <strong>table dans la base de données</strong>.</p> <p>D'abord, si vous ne l'avez pas déjà fait, il faut créer la base de données. Pour cela, il suffit d'exécuter la commande (vous n'avez à le faire qu'une seule fois évidemment) :</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>php bin/console doctrine:database:create
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="les-migrations"><a href="#les-migrations" class="header-anchor">#</a> Les migrations</h3> <p>Afin de modifier la structures de notre base de données, nous allons utiliser un autre bundle : <strong>DoctrineMigrationsBundle</strong>.</p> <p>Premièrement, nous allons <strong>comparer l'état actuel de notre base de données</strong> avec les informations que nous avons fournit à Doctrine à travers <strong>les métadata des entités</strong> :</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>php bin/console doctrine:migrations:diff
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Pour l'instant, rien n'a modifié notre base de données. Cette commande à générer un fichier pour nous dans le dossier <strong>migrations</strong> (depuis la racine du projet). Dans celle-ci se trouvent deux méthodes intéressantes :</p> <ul><li><strong>up</strong> qui contient tout le SQL à éxécuter pour que notre base de données soit à jour.</li> <li><strong>down</strong> qui contient le SQL pour revenir à l'état précédant.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Pensez à toujours vérifier ces requêtes, pour être sûrs de ne pas avoir fait d'erreur dans le mapping des entités.</p></div> <p>Mais maintenant, il est temps de passer aux choses sérieuses, et d'<strong>exécuter concrètement</strong> ce SQL avec la commande suivante :</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>php bin/console doctrine:migrations:migrate
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Si tout se passe bien, en ouvrant <strong>phpMyAdmin</strong> et en allant dans votre base de données vous devriez pouvoir constater le résultat. Les tables correspondantes aux entités ont été créées et les annotations prises en compte pour tous les champs.</p> <p>Vous pouvez également <strong>modifier</strong> une entité depuis sa classe (ou avec la commande make:entity) en y ajoutant ou en retirant des champs. Une fois l'opération réalisée et le fichier enregistré, il vous faudra <strong>relancer les commandes précédentes</strong>.</p> <h2 id="interagir-avec-doctrine"><a href="#interagir-avec-doctrine" class="header-anchor">#</a> Interagir avec Doctrine</h2> <p>Doctrine est un projet très complet qui est constitué de plusieurs packages, dont principalement :</p> <ul><li><strong>Le DBAL</strong> (Doctrine Abstraction layer) : C'est la couche <strong>bas niveau</strong> de Doctrine. Elle consiste principalement en une <strong>abstraction de PDO</strong> et permet donc de fournir une interface commune, <strong>peu importe le SGDB utilisé</strong> (MySQL, PostgreSQL, ...).</li> <li><strong>L'ORM</strong> : C'est la couche <strong>haut niveau</strong>, qui nous permet de manipuler nos entités, rendant transparentes la plupart des interactions que l'on pourrait avoir avec la base de données. On utilisera dans ce but principalement l'<strong>EntityManager</strong>.</li></ul> <p>Voici comment injecter cet <strong>EntityManager</strong>, encore une fois, en typant sur son interface :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM<span class="token punctuation">\</span>EntityManagerInterface</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token class-name type-declaration">EntityManagerInterface</span> <span class="token variable">$em</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>C'est avec l'<strong>EntityManager</strong> que l'on va passer le plus clair de notre temps. C'est lui qui permet de dire à Doctrine « Persiste cet objet », c'est lui qui va exécuter les requêtes SQL (que l'on ne verra jamais car nous utilisons une couche d'abstraction), bref, c'est lui qui fera tout.</p> <p>La seule chose qu'il ne sait pas faire facilement, c'est récupérer les entités depuis la base de données. Pour faciliter l'accès aux objets, on va utiliser des <strong>Repository</strong>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Lorsque vous avez généré votre entité avec la commande, elle a aussi généré le repository pour vous dans le dossier <strong>/src/Repository/</strong>.</p></div> <h3 id="insertion"><a href="#insertion" class="header-anchor">#</a> Insertion</h3> <p>L'enregistrement effectif en base de données se fait en deux étapes depuis un service, dans lequel on a injecté au préalable l'<strong>EntityManager</strong> :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// Création de l'entité Product</span>
<span class="token variable">$product</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Le nom'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Une super description'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">129.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Etape 1 : On &quot;persiste&quot; l'entité</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">em</span><span class="token operator">-&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$product</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Etape 2 : On &quot;flush&quot; tout ce qui a été persisté avant</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">em</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Remarquez la syntaxe utilisée pour créer l'instance de notre entité Product. Si on entoure la création d'un objet de parenthèses, on peut appeler directement ses méthodes dessus. De plus, on peut enchaîner les setters car il retourne tous une instance de l'objet sur lequel ils sont appelés.</p></div> <p>Ces quelques lignes permettent simplement d'<strong>enregistrer</strong> un nouveau produit en base de données à l'aide d'une <strong>requête INSERT</strong> classique que vous n'aurez jamais l'occasion de voir au niveau de votre code.</p> <h4 id="transaction-sql"><a href="#transaction-sql" class="header-anchor">#</a> Transaction SQL</h4> <p>La création se fait en deux étapes:</p> <ul><li>La méthode <strong>persist</strong> indique à Doctrine que <strong>l'entité existe</strong> et qu'il peut <strong>traquer ses modifications</strong>.</li> <li>La méthode <strong>flush</strong> exécute toutes les insertions et modifications avec des requêtes SQL.</li></ul> <p>Doctrine va en fait gérer des <strong>transactions SQL</strong>. C'est à dire que lors de l'ajout de 10 produits, si l'une des insertions provoque une <strong>erreur SQL</strong>, <strong>aucun</strong> des produits ne sera enregistré. La méthode <strong>flush</strong> exécute en fait la transaction.</p> <h4 id="ajout-de-la-date-de-creation"><a href="#ajout-de-la-date-de-creation" class="header-anchor">#</a> Ajout de la date de création</h4> <p>Il arrive régulièrement que l'on veuille enregistrer également la <strong>date de création</strong> d'une entité. Dans le cas de notre produit nous pouvons le faire, mais nous souhaiterions que cela soit réalisé de manière automatique à l'enregistrement de notre entité. Pour cela, il suffit d'aller modifier notre entité en y ajoutant <strong>une propriété date</strong> et <strong>un constructeur</strong> qui l'initialisera :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token operator">=</span><span class="token string single-quoted-string">'datetime'</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token keyword">private</span> <span class="token class-name class-name-fully-qualified type-declaration"><span class="token punctuation">\</span>DateTime</span> <span class="token variable">$createdAt</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">createdAt</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getCreatedAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name class-name-fully-qualified return-type"><span class="token punctuation">\</span>DateTime</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">createdAt</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Bien entendu, après avoir effectué de telles modifications il va falloir, via la console, <strong>mettre à jour notre base de données</strong>.</p> <h3 id="modification"><a href="#modification" class="header-anchor">#</a> Modification</h3> <p>Après avoir vu comment enregistrer une nouvelle entité, voyons comment en <strong>récupérer</strong> une et la <strong>modifier</strong>, toujours grâce à notre <strong>EntityManager</strong> :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>
<span class="token comment">// On récupère le produit grâce au repository avec la méthode find()</span>
<span class="token comment">// qui prend en paramètre l'id de notre entité (SELECT ... WHERE id = 5)</span>
<span class="token variable">$product</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">productRepository</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$product</span><span class="token operator">-&gt;</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Produit 5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Pas besoin de persister car l'ORM connaît déjà notre entité, c'est lui qui vient de nous la fournir.</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">em</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Dans ce cas, la méthode <strong>flush()</strong> n'effectue plus un INSERT dans notre base de données, mais un <strong>UPDATE</strong> de notre entité déjà existante (l'EntityManager de Doctrine gère ça tout seul). Vous constaterez dans l'exemple précédent l'utilisation de la méthode <strong>find()</strong> permettant d'aller récupérer un enregistrement par rapport à son identifiant. Il est également possible d'utiliser la méthode <strong>findAll()</strong> afin de récupérer l'ensemble des enregistrements.</p> <h3 id="suppression"><a href="#suppression" class="header-anchor">#</a> Suppression</h3> <p>De la même manière vous avez la possibilité d'exécuter une requête DELETE en utilisant la méthode <strong>remove()</strong> de l'<strong>EntityManager</strong> :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$product</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">productRepository</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">em</span><span class="token operator">-&gt;</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token variable">$product</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">em</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="des-donnees-de-developpement"><a href="#des-donnees-de-developpement" class="header-anchor">#</a> Des données de développement</h2> <p>Les <strong>fixtures</strong> sont utilisées pour charger un ensemble de données dans une base de données. Ces données peuvent être utilisées pour les tests ou peuvent être les données initiales nécessaires au bon fonctionnement de l'application.</p> <p>La mise en place de fixtures nécessite l'utilisation d'un bundle :</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">composer</span> require --dev doctrine/doctrine-fixtures-bundle
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ou en version courte grâce à Flex:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">composer</span> req --dev orm-fixtures
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Flex a également créé un fichier de fixtures <strong>App\DataFixtures\AppFixtures</strong> que nous allons remplir de la façon suivante :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>DataFixtures</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Store<span class="token punctuation">\</span>Product</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FixturesBundle<span class="token punctuation">\</span>Fixture</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Common<span class="token punctuation">\</span>Persistence<span class="token punctuation">\</span>ObjectManager</span><span class="token punctuation">;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">AppFixtures</span> <span class="token keyword">extends</span> <span class="token class-name">Fixture</span>
<span class="token punctuation">{</span>
    <span class="token comment">/** @var ObjectManager */</span>
    <span class="token keyword">private</span> <span class="token variable">$manager</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">load</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ObjectManager</span> <span class="token variable">$manager</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">manager</span> <span class="token operator">=</span> <span class="token variable">$manager</span><span class="token punctuation">;</span>

        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">loadProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">manager</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">loadProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$product</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span>
                <span class="token string single-quoted-string">'product '</span><span class="token operator">.</span><span class="token variable">$i</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'Produit de description '</span><span class="token operator">.</span><span class="token variable">$i</span><span class="token punctuation">,</span>
                <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">manager</span><span class="token operator">-&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$product</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Vous pouvez écrire n'importe quoi pour générer vos fixtures donc si vous voulez être plus créatif, ne vous gênez pas ! Vous pouvez par exemple prendre exemple sur <a href="https://github.com/symfony/demo/blob/master/src/DataFixtures/AppFixtures.php" target="_blank" rel="noopener noreferrer">les fixtures de l'application de demo de Symfony<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>Il ne reste plus qu'à charger les fixtures en exécutant la commande suivante :</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ php bin/console doctrine:fixtures:load
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Les données présentent dans les fixtures devraient à présent avoir été intégrées dans votre base de données.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Lorsque vous lancez la commande, elle vous demande de vider les données de votre base de données pour pouvoir s'exécuter, et ce à chaque fois.</p></div> <h2 id="a-vous-de-jouer"><a href="#a-vous-de-jouer" class="header-anchor">#</a> A vous de jouer</h2> <p>Rendons l'affichage de nos produits dynamique en créant une base de données et la table correspondante.</p> <ol><li>Configurez le projet Symfony afin de le lier à une base de données en paramétrant le fichier <strong>/.env.local</strong>.</li> <li>Créez l'entité <strong>App\Entity\Store\Product</strong> et générez la table correspondante dans votre base de données comprenant les champs suivants : <em>id, name (string 255), description (text), price (float), created_at (datetime_immutable)</em>.</li> <li>Complétez manuellement l'entité <strong>App\Entity\Contact</strong>. Ajoutez également le <strong>createdAt</strong> et nommez sa table <strong>app_contact</strong></li> <li>Enregistrez la demande de contact après validation du formulaire et avant d'envoyer cette dernière par email.</li> <li>Mettre en place une classe gérant les <strong>fixtures</strong> et implémentez-y une boucle chargée de peupler votre table de <strong>14 produits</strong>.</li> <li>Affichez sur la page de <strong>listing des produits</strong> les fiches produits issues de la base de données, en pensant à afficher un message dans le cas où le catalogue ne dispose d'aucuns produits enregistrés.</li> <li>Utilisez un <strong>filtre Twig</strong> permettant de toujours afficher le nom des produits avec une <strong>majuscule sur la première lettre</strong>.</li></ol> <h2 id="pour-aller-plus-loin"><a href="#pour-aller-plus-loin" class="header-anchor">#</a> Pour aller plus loin</h2> <ul><li><a href="https://symfony.com/doc/current/bundles/DoctrineMigrationsBundle/index.html" target="_blank" rel="noopener noreferrer">Documentation de Symfony sur le DoctrineMigrationsBundle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cours/service.html" class="prev">
        Les services avec Symfony
      </a></span> <span class="next"><a href="/cours/relations.html">
        Relations entre entités
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f5ffb287.js" defer></script><script src="/assets/js/2.85d345eb.js" defer></script><script src="/assets/js/11.08c438c2.js" defer></script>
  </body>
</html>
