<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Relations entre entités | Introduction à Symfony</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Licence Professionnelle SIL - Web et Mobile pour le Commerce Électronique">
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="preload" href="/assets/css/0.styles.e2f7dcf9.css" as="style"><link rel="preload" href="/assets/js/app.f5ffb287.js" as="script"><link rel="preload" href="/assets/js/2.85d345eb.js" as="script"><link rel="preload" href="/assets/js/18.62e92111.js" as="script"><link rel="prefetch" href="/assets/js/10.457dba52.js"><link rel="prefetch" href="/assets/js/11.08c438c2.js"><link rel="prefetch" href="/assets/js/12.cbc1776f.js"><link rel="prefetch" href="/assets/js/13.418be2c7.js"><link rel="prefetch" href="/assets/js/14.d52a0530.js"><link rel="prefetch" href="/assets/js/15.21450e21.js"><link rel="prefetch" href="/assets/js/16.872dd91c.js"><link rel="prefetch" href="/assets/js/17.b3e69a97.js"><link rel="prefetch" href="/assets/js/19.e575b9c0.js"><link rel="prefetch" href="/assets/js/20.2dd543f1.js"><link rel="prefetch" href="/assets/js/21.207e0e56.js"><link rel="prefetch" href="/assets/js/22.d2fc0852.js"><link rel="prefetch" href="/assets/js/23.d71aaa5c.js"><link rel="prefetch" href="/assets/js/24.4a856b70.js"><link rel="prefetch" href="/assets/js/25.886f50e9.js"><link rel="prefetch" href="/assets/js/26.7345d31d.js"><link rel="prefetch" href="/assets/js/27.98540e6e.js"><link rel="prefetch" href="/assets/js/28.6a30ed2d.js"><link rel="prefetch" href="/assets/js/29.932c0b60.js"><link rel="prefetch" href="/assets/js/3.0cf10e4b.js"><link rel="prefetch" href="/assets/js/30.aa92a368.js"><link rel="prefetch" href="/assets/js/31.e026dfd1.js"><link rel="prefetch" href="/assets/js/32.0aec1f2e.js"><link rel="prefetch" href="/assets/js/33.9dd3d5d8.js"><link rel="prefetch" href="/assets/js/4.0a2f3beb.js"><link rel="prefetch" href="/assets/js/5.a33a2f42.js"><link rel="prefetch" href="/assets/js/6.f0091315.js"><link rel="prefetch" href="/assets/js/7.53d7b1d5.js"><link rel="prefetch" href="/assets/js/8.bae4ccb5.js"><link rel="prefetch" href="/assets/js/9.280a7124.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2f7dcf9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Introduction à Symfony</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cours/" class="nav-link router-link-active">
  Cours
</a></div><div class="nav-item"><a href="/projets/" class="nav-link">
  Projets
</a></div><div class="nav-item"><a href="/ressources/" class="nav-link">
  Ressources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cours/" class="nav-link router-link-active">
  Cours
</a></div><div class="nav-item"><a href="/projets/" class="nav-link">
  Projets
</a></div><div class="nav-item"><a href="/ressources/" class="nav-link">
  Ressources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cours/" aria-current="page" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/#qu-est-ce-qu-un-framework" class="sidebar-link">Qu'est ce qu'un framework ?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/#definition" class="sidebar-link">Définition</a></li><li class="sidebar-sub-header"><a href="/cours/#objectifs-d-un-framework" class="sidebar-link">Objectifs d'un framework</a></li><li class="sidebar-sub-header"><a href="/cours/#avantages-et-inconvenients-d-un-framework" class="sidebar-link">Avantages et inconvénients d'un framework</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/#decouvrir-symfony" class="sidebar-link">Découvrir Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/#presentation-generale" class="sidebar-link">Présentation générale</a></li><li class="sidebar-sub-header"><a href="/cours/#pourquoi-symfony-et-pas-un-autre" class="sidebar-link">Pourquoi Symfony et pas un autre ?</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/installation.html" class="sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/installation.html#prerequis" class="sidebar-link">Prérequis</a></li><li class="sidebar-sub-header"><a href="/cours/installation.html#telecharger-et-installer-symfony" class="sidebar-link">Télécharger et installer Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/installation.html#parenthese-sur-composer" class="sidebar-link">Parenthèse sur Composer</a></li><li class="sidebar-sub-header"><a href="/cours/installation.html#premier-projet-symfony" class="sidebar-link">Premier projet Symfony</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/installation.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/structure.html" class="sidebar-link">Structure du projet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/structure.html#la-console-de-symfony" class="sidebar-link">La console de Symfony</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#la-partie-publique" class="sidebar-link">La partie publique</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#le-code-source-php" class="sidebar-link">Le code source PHP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/structure.html#un-point-sur-le-kernel" class="sidebar-link">Un point sur le Kernel</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-templates" class="sidebar-link">Les templates</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-fichiers-temporaires" class="sidebar-link">Les fichiers temporaires</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/structure.html#le-dossier-var-cache" class="sidebar-link">Le dossier /var/cache/</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#le-dossier-var-log" class="sidebar-link">Le dossier /var/log/</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-dependances" class="sidebar-link">Les dépendances</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#les-variables-d-environnement" class="sidebar-link">Les variables d'environnement</a></li><li class="sidebar-sub-header"><a href="/cours/structure.html#la-configuration-de-composer" class="sidebar-link">La configuration de Composer</a></li></ul></li><li><a href="/cours/bundle-et-flex.html" class="sidebar-link">Bundles, Flex et auto-configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/bundle-et-flex.html#qu-est-ce-qu-un-bundle" class="sidebar-link">Qu'est ce qu'un bundle ?</a></li><li class="sidebar-sub-header"><a href="/cours/bundle-et-flex.html#symfony-et-flex" class="sidebar-link">Symfony et Flex</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/bundle-et-flex.html#nettoyage-du-projet" class="sidebar-link">Nettoyage du projet</a></li></ul></li></ul></li><li><a href="/cours/controleur-et-routing.html" class="sidebar-link">Contrôleur et Routing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#requete-et-reponse" class="sidebar-link">Requête et réponse</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#routing" class="sidebar-link">Routing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#fonctionnement" class="sidebar-link">Fonctionnement</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#configuration-d-une-route" class="sidebar-link">Configuration d'une route</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#les-parametres-d-une-route" class="sidebar-link">Les paramètres d'une route</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#debug-des-routes" class="sidebar-link">Debug des routes</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#controleur" class="sidebar-link">Contrôleur</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#generer-des-urls" class="sidebar-link">Générer des URLs</a></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#manipuler-l-objet-request" class="sidebar-link">Manipuler l'objet Request</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/controleur-et-routing.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/twig.html" class="sidebar-link">Le moteur de template Twig</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/twig.html#les-templates-dans-symfony" class="sidebar-link">Les templates dans Symfony</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#la-syntaxe-de-twig" class="sidebar-link">La syntaxe de Twig</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/twig.html#comparaison-entre-php-et-twig" class="sidebar-link">Comparaison entre PHP et Twig</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#les-filtres" class="sidebar-link">Les filtres</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/twig.html#integration-dans-symfony" class="sidebar-link">Intégration dans Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/twig.html#generation-de-lien" class="sidebar-link">Génération de lien</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#gestion-des-assets" class="sidebar-link">Gestion des assets</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/twig.html#heritage-de-templates" class="sidebar-link">Héritage de templates</a></li><li class="sidebar-sub-header"><a href="/cours/twig.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/formulaire.html" class="sidebar-link">Formulaires</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/formulaire.html#creation-d-un-objet-contact" class="sidebar-link">Création d'un objet Contact</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#creation-d-une-classe-de-formulaire" class="sidebar-link">Création d'une classe de formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#implementation-du-formulaire" class="sidebar-link">Implementation du formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#affichage-du-formulaire" class="sidebar-link">Affichage du formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#protection-csrf" class="sidebar-link">Protection CSRF</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#validation-du-formulaire" class="sidebar-link">Validation du formulaire</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#les-messages-flash" class="sidebar-link">Les messages flash</a></li><li class="sidebar-sub-header"><a href="/cours/formulaire.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/injection-dependances.html" class="sidebar-link">L'injection de dépendances</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#definition" class="sidebar-link">Définition</a></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#le-conteneur-d-injection-de-dependances" class="sidebar-link">Le conteneur d'injection de dépendances</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#les-factories" class="sidebar-link">Les factories</a></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#la-configuration" class="sidebar-link">La configuration</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#l-autowiring" class="sidebar-link">L'Autowiring</a></li><li class="sidebar-sub-header"><a href="/cours/injection-dependances.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/service.html" class="sidebar-link">Les services avec Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#les-services" class="sidebar-link">Les services</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#creer-un-service" class="sidebar-link">Créer un service</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#utiliser-un-service" class="sidebar-link">Utiliser un service</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#lister-les-services-graces-a-la-console" class="sidebar-link">Lister les services grâces à la console</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#configuration" class="sidebar-link">Configuration</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/service.html#les-parametres" class="sidebar-link">Les paramètres</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#utilite-et-definition" class="sidebar-link">Utilité et définition</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#utilisation-dans-la-configuration" class="sidebar-link">Utilisation dans la configuration</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#utilisation-dans-un-service" class="sidebar-link">Utilisation dans un service</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/service.html#exemple-utilisation-du-mailer" class="sidebar-link">Exemple : Utilisation du Mailer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/service.html#l-envoi-d-un-email" class="sidebar-link">L'envoi d'un email</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#analyser-ses-envois" class="sidebar-link">Analyser ses envois</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/service.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li><li class="sidebar-sub-header"><a href="/cours/service.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/entities.html" class="sidebar-link">Les entités Doctrine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/entities.html#creer-une-entite" class="sidebar-link">Créer une entité</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#gerer-l-etat-de-la-base-de-donnees" class="sidebar-link">Gérer l'état de la base de données</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/entities.html#les-migrations" class="sidebar-link">Les migrations</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/entities.html#interagir-avec-doctrine" class="sidebar-link">Interagir avec Doctrine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/entities.html#insertion" class="sidebar-link">Insertion</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#modification" class="sidebar-link">Modification</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#suppression" class="sidebar-link">Suppression</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/entities.html#des-donnees-de-developpement" class="sidebar-link">Des données de développement</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li><li class="sidebar-sub-header"><a href="/cours/entities.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/relations.html" aria-current="page" class="active sidebar-link">Relations entre entités</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/relations.html#quelques-notions-importantes" class="sidebar-link">Quelques notions importantes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/relations.html#notion-de-proprietaire-et-d-inverse" class="sidebar-link">Notion de propriétaire et d'inverse</a></li><li class="sidebar-sub-header"><a href="/cours/relations.html#notion-d-unidirectionnalite-et-de-bidirectionnalite" class="sidebar-link">Notion d'unidirectionnalité et de bidirectionnalité</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/relations.html#les-types-de-relations" class="sidebar-link">Les types de relations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/relations.html#relation-onetoone" class="sidebar-link">Relation OneToOne</a></li><li class="sidebar-sub-header"><a href="/cours/relations.html#relation-manytoone" class="sidebar-link">Relation ManyToOne</a></li><li class="sidebar-sub-header"><a href="/cours/relations.html#relation-manytomany" class="sidebar-link">Relation ManyToMany</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/relations.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li></ul></li><li><a href="/cours/repositories.html" class="sidebar-link">Les repositories</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#les-methodes-de-construction-de-query" class="sidebar-link">Les méthodes de construction de query</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#doctrine-query-language-dql" class="sidebar-link">Doctrine Query Language (DQL)</a></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#querybuilder" class="sidebar-link">QueryBuilder</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#recuperer-ses-entites" class="sidebar-link">Récupérer ses entités</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#les-methodes-de-base" class="sidebar-link">Les méthodes de base</a></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#les-methodes-magiques" class="sidebar-link">Les méthodes magiques</a></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#vos-propres-methodes" class="sidebar-link">Vos propres méthodes</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/repositories.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/repositories.html#aides" class="sidebar-link">Aides</a></li></ul></li></ul></li><li><a href="/cours/event-dispatcher.html" class="sidebar-link">L'event dispatcher</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#le-principe" class="sidebar-link">Le principe</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#envoyer-des-evenements" class="sidebar-link">Envoyer des événements</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#ecouter-les-evenements" class="sidebar-link">Écouter les événements</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#a-vous-de-jouer" class="sidebar-link">A vous de jouer</a></li><li class="sidebar-sub-header"><a href="/cours/event-dispatcher.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/mise-en-ligne.html" class="sidebar-link">La mise en ligne</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#personnaliser-les-pages-d-erreur" class="sidebar-link">Personnaliser les pages d'erreur</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#verifier-son-site-symfony" class="sidebar-link">Vérifier son site Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#tester-son-application" class="sidebar-link">Tester son application</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#verifier-la-qualite-du-code" class="sidebar-link">Vérifier la qualité du code</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#deployer-son-site-symfony-en-ligne" class="sidebar-link">Déployer son site Symfony en ligne</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#sans-acces-ssh" class="sidebar-link">Sans accès SSH</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#avec-acces-ssh" class="sidebar-link">Avec accès SSH</a></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#explications-en-details" class="sidebar-link">Explications en détails</a></li></ul></li><li class="sidebar-sub-header"><a href="/cours/mise-en-ligne.html#pour-aller-plus-loin" class="sidebar-link">Pour aller plus loin</a></li></ul></li><li><a href="/cours/plus-loin.html" class="sidebar-link">Pour aller plus loin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#sur-symfony" class="sidebar-link">Sur Symfony</a></li><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#s-ameliorer" class="sidebar-link">S'améliorer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#pourquoi" class="sidebar-link">Pourquoi</a></li><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#comment" class="sidebar-link">Comment</a></li><li class="sidebar-sub-header"><a href="/cours/plus-loin.html#comment-apprendre" class="sidebar-link">Comment apprendre ?</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="relations-entre-entites"><a href="#relations-entre-entites" class="header-anchor">#</a> Relations entre entités</h1> <p>Le chapitre précédent nous a permis d'introduire l'ensemble des notions de base liées au modèle de données au sein du framework. Nous savons donc à présent créer une entité, l'injecter sous forme de table dans notre base de données, et également interagir avec elle grâce au service Doctrine. Ce nouveau chapitre va vous faire découvrir la notion de relations entre les entités.</p> <h2 id="quelques-notions-importantes"><a href="#quelques-notions-importantes" class="header-anchor">#</a> Quelques notions importantes</h2> <h3 id="notion-de-proprietaire-et-d-inverse"><a href="#notion-de-proprietaire-et-d-inverse" class="header-anchor">#</a> Notion de propriétaire et d'inverse</h3> <p>La notion de propriétaire et d'inverse est abstraite mais importante à comprendre. Dans une relation entre deux entités, il y a toujours une entité dite <strong>propriétaire</strong>, et une dite <strong>inverse</strong>. Pour comprendre cette notion, il faut revenir à la vieille époque, lorsque l'on faisait nos bases de données à la main. En générale, <strong>l'entité propriétaire est celle qui contient la référence à l'autre entité</strong>. Ce sera également l'entité qui <strong>recevra le mapping</strong> (attributes), c'est pourquoi il est important de l'identifier.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Cette notion, à avoir en tête lors de la création des entités, n'est pas liée à votre logique métier mais est purement technique.</p></div> <p>Prenons pour exemple les produits de nos marques : En SQL pur, vous disposeriez de la table <strong>sto_brand</strong> (pour les marques) et de la table <strong>sto_product</strong> (pour les produits). Pour créer une relation entre ces deux tables, vous allez mettre naturellement une colonne brand_id dans la table product. La table <strong>sto_product</strong> est donc propriétaire de la relation, car c'est elle qui contient la colonne de liaison brand_id.</p> <h3 id="notion-d-unidirectionnalite-et-de-bidirectionnalite"><a href="#notion-d-unidirectionnalite-et-de-bidirectionnalite" class="header-anchor">#</a> Notion d'unidirectionnalité et de bidirectionnalité</h3> <p>Une relation peut être à sens unique ou à double sens. Une relation unidirectionnelle signifie que vous pourrez faire <strong>$entiteProprietaire-&gt;getEntiteInverse()</strong> (dans notre exemple $product-&gt;getBrand()), mais vous ne pourrez pas faire <strong>$entiteInverse-&gt;getEntiteProprietaire()</strong> (pour nous, $brand-&gt;getProducts()). Cela ne nous empêchera pas de récupérer les produits d'une marque, on utilisera juste une autre méthode, via le repository.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Si une relation est toujours au moins unidirectonnelle, on préfère éviter de la rendre bidirectionnelle si ce n'est pas nécessaire, du point de vue de la logique métier.</p></div> <h2 id="les-types-de-relations"><a href="#les-types-de-relations" class="header-anchor">#</a> Les types de relations</h2> <p>Il y a plusieurs façons de lier des entités entre elles. En effet, il n'est pas pareil de lier une multitude de produits à une seule marque et de lier un membre à un seul avis. Il existe donc plusieurs types de relations, pour répondre à plusieurs besoins concrets. Ce sont les relations <strong>OneToOne</strong>, <strong>ManyToOne</strong> et <strong>ManyToMany</strong>.</p> <h3 id="relation-onetoone"><a href="#relation-onetoone" class="header-anchor">#</a> Relation OneToOne</h3> <p>La relation <strong>OneToOne</strong>, ou 1..1, est assez classique. Elle correspond, comme son nom l'indique, à une relation unique entre deux objets. Pour illustrer cette relation dans le cadre de notre projet, nous allons créer une entité <strong>Image</strong>. Imaginons qu'on offre la possibilité de lier une image à un produit. Si à chaque produit on ne peut afficher <strong>qu'une seule image</strong>, et que chaque image ne peut être liée <strong>qu'à un seul produit</strong>, alors on est bien dans le cadre d'une relation <strong>OneToOne</strong>. La figure suivante schématise cela :</p> <p><img src="/img/one-to-one.png" alt="Relation OneToOne"></p> <h4 id="definition"><a href="#definition" class="header-anchor">#</a> Définition</h4> <p>Afin d'établir notre relation nous devons utiliser les <em>attributes</em> au niveau de nos entités. La relation <strong>OneToOne</strong> entre les entités <strong>Product</strong> et <strong>Image</strong> correspondrait à la syntaxe suivant. Aucun ajout n'est nécessaire au niveau de l'entité Image, car nous allons faire une <strong>relation unidirectionnelle</strong> :</p> <div class="language-php line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-php"><code><span class="token comment">// src/Entity/Store/Product.php</span>

<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>OneToOne</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">targetEntity</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">Image</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">cascade</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'persist'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token keyword">private</span> <span class="token operator">?</span><span class="token class-name type-declaration">Image</span> <span class="token variable">$image</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token class-name return-type">Image</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">image</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setImage</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token class-name type-declaration">Image</span> <span class="token variable">$image</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">image</span> <span class="token operator">=</span> <span class="token variable">$image</span>

    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Cette relation est simple et tout à fait fonctionnelle, néanmoins par défaut cette relation est facultative. C'est à dire que vous pouvez avoir un Produit sans Image. Afin de rendre la relation obligatoire il suffit de rajouter un <em>attribut</em> <strong>JoinColumn</strong> :</p> <div class="language-php line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-php"><code><span class="token comment">// src/Entity/Store/Product.php</span>

<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>OneToOne</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">targetEntity</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">Image</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">cascade</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'persist'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'remove'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>JoinColumn</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">nullable</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">false</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'sto_image_id'</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token keyword">private</span> <span class="token class-name type-declaration">Image</span> <span class="token variable">$image</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Vous pouvez remarquer que j'ai ajouté le nom de la colonne de jointure pour qu'il corresponde au nom de notre table, suivit de &quot;_id&quot;. Par défaut, Doctrine l'aurait nommé &quot;image_id&quot;.</p></div> <h4 id="utilisation"><a href="#utilisation" class="header-anchor">#</a> Utilisation</h4> <p>Grâce à cette relation il est maintenant possible depuis notre objet Product d'accéder à notre image et à l'ensemble de ses propriétés, nous pouvons par exemple faire :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$image</span> <span class="token operator">=</span> <span class="token variable">$product</span><span class="token operator">-&gt;</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$image</span><span class="token operator">-&gt;</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Ou en une ligne</span>
<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$product</span><span class="token operator">-&gt;</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="relation-manytoone"><a href="#relation-manytoone" class="header-anchor">#</a> Relation ManyToOne</h3> <p>La relation <strong>ManyToOne</strong>, ou n..1, est assez classique également. Elle correspond, comme son nom l'indique, à une relation qui permet à une entité A d'avoir une relation avec plusieurs entités B.</p> <p>Pour illustrer cette relation dans le cadre de notre projet, nous allons créer une entité <strong>Brand</strong> qui représente les marques associées aux produits. L'idée est de pouvoir ajouter plusieurs produits à une marque, et que chaque produit ne soit liée qu'à une seule marque. Nous avons ainsi plusieurs produits (Many) à lier à (To) une seule marque (One). La figure suivante schématise cela :</p> <p><img src="/img/many-to-one.png" alt="Relation ManyToOne"></p> <h4 id="definition-2"><a href="#definition-2" class="header-anchor">#</a> Définition</h4> <p>Comme précédemment nous allons intervenir au niveau des <em>attributes</em> de nos entités pour établir une relation <strong>ManyToOne</strong> (de nouveau, aucun ajout n'est nécessaire au niveau de l'entité Brand) :</p> <div class="language-php line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-php"><code><span class="token comment">// src/Entity/Store/Product.php</span>

<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>ManyToOne</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">targetEntity</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">Brand</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">JoinColumn</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">nullable</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">false</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'sto_brand_id'</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token keyword">private</span> <span class="token class-name type-declaration">Brand</span> <span class="token variable">$brand</span><span class="token punctuation">;</span>

<span class="token comment">// Getters and Setters</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="utilisation-2"><a href="#utilisation-2" class="header-anchor">#</a> Utilisation</h4> <p>De la même manière que pour la relation <strong>OneToOne</strong>, il vous faut définir le <strong>getter</strong> et le <strong>setter</strong> en pensant à bien forcer le type à l'aide de l'entité à laquelle nous faisons référence. Puis nous pourrions ensuite les utiliser de la façon suivante :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$brand</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Brand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Adidas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$product</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">productRepository</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$product</span><span class="token operator">-&gt;</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token variable">$brand</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">em</span><span class="token operator">-&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$brand</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">em</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="definition-bidirectionnelle"><a href="#definition-bidirectionnelle" class="header-anchor">#</a> Définition bidirectionnelle</h4> <p>En ayant mis en place la relation <strong>ManyToOne</strong> ainsi, nous avons établi une règle d'unidirectionnalité. L'inconvénient est que nous pouvons bien accéder à notre marque depuis notre objet produit, <strong>mais pas l'inverse</strong>. C'est à dire qu'il ne nous est pas possible via une méthode depuis la marque de récupérer les listes de produits correspondants. Pour l'instant, vous pouvez le faire uniquement en utilisant les repositories.</p> <p>Voici les modifications à apporter pour mettre en place une notion de bidirectionnalité entre nos deux entités :</p> <div class="language-php line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-php"><code><span class="token comment">// src/Entity/Store/Product.php</span>

<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>ManyToOne</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">targetEntity</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">Brand</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">inversedBy</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'products'</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>JoinColumn</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">nullable</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">false</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'sto_brand_id'</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token keyword">private</span> <span class="token class-name type-declaration">Brand</span> <span class="token variable">$brand</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-php line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-php"><code><span class="token comment">// src/Entity/Store/Brand.php</span>

<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>OneToMany</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">targetEntity</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">Product</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">mappedBy</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'brand'</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token keyword">private</span> <span class="token class-name type-declaration">Collection</span> <span class="token variable">$products</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Les <strong>getters et setters</strong> pour la propriété <strong>$products</strong> sont un peu particulier puisqu'il s'agit d'une array, et plus précisément une <strong>ArrayCollection</strong>. C'est un objet utilisé par Doctrine pour gérer les relations entre entités lorsque le contenu est une array. Ce qui va nous donner les méthodes suivantes :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// src/Entity/Store/Brand.php</span>

<span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Common<span class="token punctuation">\</span>Collections<span class="token punctuation">\</span>ArrayCollection</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">products</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @return Collection&lt;int, Product&gt;
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Collection</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">products</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">addProduct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Product</span> <span class="token variable">$product</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">products</span><span class="token operator">-&gt;</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token variable">$product</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">products</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$product</span><span class="token punctuation">;</span>
        <span class="token variable">$product</span><span class="token operator">-&gt;</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">removeProduct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Product</span> <span class="token variable">$product</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">products</span><span class="token operator">-&gt;</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token variable">$product</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">products</span><span class="token operator">-&gt;</span><span class="token function">removeElement</span><span class="token punctuation">(</span><span class="token variable">$product</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// set the owning side to null (unless already changed)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$product</span><span class="token operator">-&gt;</span><span class="token function">getBrand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$product</span><span class="token operator">-&gt;</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>On peut maintenant ajouter un produit à une marque en utilisant la méthode suivante :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$brand</span><span class="token operator">-&gt;</span><span class="token function">addProduct</span><span class="token punctuation">(</span><span class="token variable">$product</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="relation-manytomany"><a href="#relation-manytomany" class="header-anchor">#</a> Relation ManyToMany</h3> <p>La relation <strong>ManyToMany</strong>, ou n..n, correspond à une relation qui permet à plein d'objets d'être en relation avec plein d'autres !</p> <p>Prenons l'exemple cette fois-ci de nos produits, ayant des couleurs différentes. Un produit peut avoir plusieurs couleurs. À l'inverse, une couleur peut $etre utilisé sur plusieurs produits. On a donc une relation <strong>ManyToMany</strong> entre Product et Color. La figure suivante schématise tout cela.</p> <p><img src="/img/many-to-many.png" alt="Relation ManyToMany"></p> <h4 id="definition-3"><a href="#definition-3" class="header-anchor">#</a> Définition</h4> <p>Comme pour toutes relations, il suffit d'intervenir sur les <em>attributes</em> de nos entités :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// src/Entity/Store/Product.php</span>

<span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Common<span class="token punctuation">\</span>Collections<span class="token punctuation">\</span>ArrayCollection</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>ManyToMany</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">targetEntity</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">Color</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>JoinTable</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'sto_product_color'</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
<span class="token keyword">private</span> <span class="token class-name type-declaration">Collection</span> <span class="token variable">$colors</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">colors</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @return Collection&lt;int, Color&gt;
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getColors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Collection</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">colors</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">addColor</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Color</span> <span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">colors</span><span class="token operator">-&gt;</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">colors</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$color</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">removeColor</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Color</span> <span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">colors</span><span class="token operator">-&gt;</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">colors</span><span class="token operator">-&gt;</span><span class="token function">removeElement</span><span class="token punctuation">(</span><span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>Les relations <strong>ManyToMany</strong> passe par une <strong>table intermédiaire</strong>. Sa clé primaire est une <strong>clé composée</strong> avec une référence sur l'id des deux entités qu'elle lie. Ca signifie aussi qu'il n'est pas possible d'avoir une entrée avec les deux même id (un produit ne peut avoir qu'une seule fois la couleur jaune).</p> <p>Vous pouvez remarquez à la <strong>ligne 5</strong> que j'ai utilisé l'attribut <strong>ORM\JoinTable</strong> pour redéfinir le nom de cette table de liaison afin qu'elle respecte le préfixe &quot;sto_&quot;.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Si vous voulez ajouter d'autres champs à cette table intermédiaire, vous ne pouvez pas utiliser la relation <strong>ManyToMany</strong>. Il faudra créer une entité <strong>ProductColor</strong> avec une relation <strong>ManyToOne</strong> sur Product et Color (et rendre ces relations bidirectionnelles).</p></div> <h4 id="utilisation-3"><a href="#utilisation-3" class="header-anchor">#</a> Utilisation</h4> <p>Voyons à présent un exemple concret de l'utilisation de ces deux entités.</p> <p>Le code suivant représente une action d'association des couleurs récupérées en base de données à un produit :</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$product</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">productRepository</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$product</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NotFoundHttpException</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Le produit d\'id '</span><span class="token operator">.</span><span class="token variable">$id</span><span class="token operator">.</span><span class="token string single-quoted-string">'n\'existe pas.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// On récupère toutes les couleurs de la base de données</span>
<span class="token variable">$colors</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">colorRepository</span><span class="token operator">-&gt;</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Ici, on ajoute toutes les couleurs au produit.</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$colors</span> <span class="token class-name type-declaration">in</span> <span class="token variable">$color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$product</span><span class="token operator">-&gt;</span><span class="token function">addColor</span><span class="token punctuation">(</span><span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">em</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Nous pouvons également afficher les couleurs de notre produit dans un template Twig :</p> <div class="language-twig line-numbers-mode"><pre class="language-twig"><code><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">if</span> product<span class="token punctuation">.</span>colors<span class="token operator">|</span>length <span class="token delimiter punctuation">%}</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        Le produit est composé des couleurs suivantes :
        <span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">for</span> color <span class="token operator">in</span> product<span class="token punctuation">.</span>colors <span class="token delimiter punctuation">%}</span></span>
            <span class="token twig language-twig"><span class="token delimiter punctuation">{{</span> color<span class="token punctuation">.</span>name <span class="token operator">~</span> <span class="token punctuation">(</span>not loop<span class="token punctuation">.</span>last <span class="token operator">?</span> <span class="token string"><span class="token punctuation">'</span>, <span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span>
        <span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">endfor</span> <span class="token delimiter punctuation">%}</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">endif</span> <span class="token delimiter punctuation">%}</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="a-vous-de-jouer"><a href="#a-vous-de-jouer" class="header-anchor">#</a> A vous de jouer</h2> <p>Maintenant que nous avons vu comment mettre en place des relations entre nos entités, nous allons pouvoir compléter notre projet.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>N'oubliez pas de vous servir de la la commande <strong>make:entity</strong> pour générer vos entités, mais aussi pour les compléter ! En effet, si vous utilisez le type <strong>relation</strong>, la commande va vous aider à générer tout ce qu'il faut de la bonne manière.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>N'oubliez pas de faire attention aux noms des tables et des colonnes de jointures (préfixe <strong>sto_</strong>).</p></div> <ol><li>Créer une nouvelle entité <strong>Image</strong> composée des propriétés suivantes : id, url (string 255), alt (string 255). Puis établissez une <strong>relation OneToOne</strong> avec l'entité Product.</li> <li>Compléter vos <strong>fixtures</strong> et afficher les images des produits dans votre template représentant la liste des produits (utiliser les images produits présentes dans votre répertoire img).</li> <li>Maintenant que votre liste de produit est dynamique et que vous pouvez afficher l'image de ces derniers, ajouter une <strong>description longue</strong> et un <strong>slug</strong> à votre entité <strong>Product</strong> (et à vos fixtures).</li> <li>Rendre dynamique l'affichage des fiches détaillées de vos produits en vérifiant bien que l'identifiant du produit que vous cherchez à afficher existe. Si ce n'est pas le cas, renvoyez un code <strong>HTTP 404</strong> (les espaces dédiés aux commentaires et celui des marques resteront statiques).</li> <li>Créer une nouvelle entité <strong>Brand</strong> composée des propriétés suivantes : id, name (string 255). Puis établir une relation <strong>ManyToOne</strong> de type <strong>bidirectionnelle</strong> avec l'entité Product et compléter vos fixtures.</li> <li>Afficher la liste des marques de produits de manière dynamique dans vos templates.</li> <li>Créer une entité <strong>Color</strong> composée des propriétés suivantes : id, name (string 255). Puis établir une relation <strong>ManyToMany</strong> de type <strong>unidirectionnelle</strong> avec l'entité Product et compléter vos fixtures.</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cours/entities.html" class="prev">
        Les entités Doctrine
      </a></span> <span class="next"><a href="/cours/repositories.html">
        Les repositories
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f5ffb287.js" defer></script><script src="/assets/js/2.85d345eb.js" defer></script><script src="/assets/js/18.62e92111.js" defer></script>
  </body>
</html>
